(function(a){a.extend({head:function(b,d,e,c){if(a.isFunction(d)){e=d;d={}}if(c==undefined){c=2000}return a.ajax({type:"HEAD",url:b,data:d,timeout:c,complete:function(h,o){try{var n=h.getAllResponseHeaders().split("\n");var f={};var g=n.length;for(var k=0;k<g;k++){if(n[k].length!=0){header=n[k].split(": ");f[header[0]]=header[1]}}if(a.isFunction(e)){e(f)}}catch(m){}}})}})})(jQuery);(function($){$.fn.editable=function(target,options){if("disable"==target){$(this).data("disabled.editable",true);return}if("enable"==target){$(this).data("disabled.editable",false);return}if("destroy"==target){$(this).unbind($(this).data("event.editable")).removeData("disabled.editable").removeData("event.editable");return}var settings=$.extend({},$.fn.editable.defaults,{target:target},options);var plugin=$.editable.types[settings.type].plugin||function(){};var submit=$.editable.types[settings.type].submit||function(){};var buttons=$.editable.types[settings.type].buttons||$.editable.types.defaults.buttons;var content=$.editable.types[settings.type].content||$.editable.types.defaults.content;var element=$.editable.types[settings.type].element||$.editable.types.defaults.element;var reset=$.editable.types[settings.type].reset||$.editable.types.defaults.reset;var callback=settings.callback||function(){};var onedit=settings.onedit||function(){};var onsubmit=settings.onsubmit||function(){};var onreset=settings.onreset||function(){};var onerror=settings.onerror||reset;if(settings.tooltip){$(this).attr("title",settings.tooltip)}settings.autowidth="auto"==settings.width;settings.autoheight="auto"==settings.height;return this.each(function(){var self=this;var savedwidth=$(self).width();var savedheight=$(self).height();$(this).data("event.editable",settings.event);if(!$.trim($(this).html())){$(this).html(settings.placeholder)}$(this).bind(settings.event,function(e){if(true===$(this).data("disabled.editable")){return}if(self.editing){return}if(false===onedit.apply(this,[settings,self])){return}e.preventDefault();e.stopPropagation();if(settings.tooltip){$(self).removeAttr("title")}if(0==$(self).width()){settings.width=savedwidth;settings.height=savedheight}else{if(settings.width!="none"){settings.width=settings.autowidth?$(self).width():settings.width}if(settings.height!="none"){settings.height=settings.autoheight?$(self).height():settings.height}}if($(this).html().toLowerCase().replace(/(;|")/g,"")==settings.placeholder.toLowerCase().replace(/(;|")/g,"")){$(this).html("")}self.editing=true;self.revert=$(self).html();$(self).html("");var form=$("<form />");if(settings.cssclass){if("inherit"==settings.cssclass){form.attr("class",$(self).attr("class"))}else{form.attr("class",settings.cssclass)}}if(settings.style){if("inherit"==settings.style){form.attr("style",$(self).attr("style"));form.css("display",$(self).css("display"))}else{form.attr("style",settings.style)}}var input=element.apply(form,[settings,self]);var input_content;if(settings.loadurl){var t=setTimeout(function(){input.disabled=true;content.apply(form,[settings.loadtext,settings,self])},100);var loaddata={};loaddata[settings.id]=self.id;if($.isFunction(settings.loaddata)){$.extend(loaddata,settings.loaddata.apply(self,[self.revert,settings]))}else{$.extend(loaddata,settings.loaddata)}$.ajax({type:settings.loadtype,url:settings.loadurl,data:loaddata,async:false,success:function(result){window.clearTimeout(t);input_content=result;input.disabled=false}})}else{if(settings.data){input_content=settings.data;if($.isFunction(settings.data)){input_content=settings.data.apply(self,[self.revert,settings])}}else{input_content=self.revert}}content.apply(form,[input_content,settings,self]);input.attr("name",settings.name);buttons.apply(form,[settings,self]);$(self).append(form);plugin.apply(form,[settings,self]);$(":input:visible:enabled:first",form).focus();if(settings.select){input.select()}input.keydown(function(e){if(e.keyCode==27){e.preventDefault();reset.apply(form,[settings,self])}});var t;if("cancel"==settings.onblur){input.blur(function(e){t=setTimeout(function(){reset.apply(form,[settings,self])},500)})}else{if("submit"==settings.onblur){input.blur(function(e){t=setTimeout(function(){form.submit()},200)})}else{if($.isFunction(settings.onblur)){input.blur(function(e){settings.onblur.apply(self,[input.val(),settings])})}else{input.blur(function(e){})}}}form.submit(function(e){if(t){clearTimeout(t)}e.preventDefault();if(false!==onsubmit.apply(form,[settings,self])){if(false!==submit.apply(form,[settings,self])){if($.isFunction(settings.target)){var str=settings.target.apply(self,[input.val(),settings]);$(self).html(str);self.editing=false;callback.apply(self,[self.innerHTML,settings]);if(!$.trim($(self).html())){$(self).html(settings.placeholder)}}else{var submitdata={};submitdata[settings.name]=input.val();submitdata[settings.id]=self.id;if($.isFunction(settings.submitdata)){$.extend(submitdata,settings.submitdata.apply(self,[self.revert,settings]))}else{$.extend(submitdata,settings.submitdata)}if("PUT"==settings.method){submitdata._method="put"}$(self).html(settings.indicator);var ajaxoptions={type:"POST",data:submitdata,dataType:"html",url:settings.target,success:function(result,status){if(ajaxoptions.dataType=="html"){$(self).html(result)}self.editing=false;callback.apply(self,[result,settings]);if(!$.trim($(self).html())){$(self).html(settings.placeholder)}},error:function(xhr,status,error){onerror.apply(form,[settings,self,xhr])}};$.extend(ajaxoptions,settings.ajaxoptions);$.ajax(ajaxoptions)}}}$(self).attr("title",settings.tooltip);return false})});this.reset=function(form){if(this.editing){if(false!==onreset.apply(form,[settings,self])){$(self).html(self.revert);self.editing=false;if(!$.trim($(self).html())){$(self).html(settings.placeholder)}if(settings.tooltip){$(self).attr("title",settings.tooltip)}}}}})};$.editable={types:{defaults:{element:function(settings,original){var input=$('<input type="hidden" id="'+settings.name+'_editable"></input>');$(this).append(input);return(input)},content:function(string,settings,original){$(":input:first",this).val("")},reset:function(settings,original){original.reset(this)},buttons:function(settings,original){var form=this;if(settings.submit){if(settings.submit.match(/>$/)){var submit=$(settings.submit).click(function(){if(submit.attr("type")!="submit"){form.submit()}})}else{var submit=$('<button type="submit" />');submit.html(settings.submit)}$(this).append(submit)}if(settings.cancel){if(settings.cancel.match(/>$/)){var cancel=$(settings.cancel)}else{var cancel=$('<button type="cancel" />');cancel.html(settings.cancel)}$(this).append(cancel);$(cancel).click(function(event){if($.isFunction($.editable.types[settings.type].reset)){var reset=$.editable.types[settings.type].reset}else{var reset=$.editable.types.defaults.reset}reset.apply(form,[settings,original]);return false})}}},text:{element:function(settings,original){var input=$("<input />");if(settings.width!="none"){input.width(settings.width)}if(settings.height!="none"){input.height(settings.height)}input.attr("autocomplete","off");$(this).append(input);return(input)}},textarea:{element:function(settings,original){var textarea=$('<textarea id="'+settings.name+'_editable" />');if(settings.rows){textarea.attr("rows",settings.rows)}else{if(settings.height!="none"){textarea.height(settings.height)}}if(settings.cols){textarea.attr("cols",settings.cols)}else{if(settings.width!="none"){textarea.width(settings.width)}}$(this).append(textarea);return(textarea)}},select:{element:function(settings,original){var select=$("<select />");$(this).append(select);return(select)},content:function(data,settings,original){if(String==data.constructor){eval("var json = "+data)}else{var json=data}for(var key in json){if(!json.hasOwnProperty(key)){continue}if("selected"==key){continue}var option=$("<option />").val(key).append(json[key]);$("select",this).append(option)}$("select",this).children().each(function(){if($(this).val()==json.selected||$(this).text()==$.trim(original.revert)){$(this).attr("selected","selected")}})}}},addInputType:function(name,input){$.editable.types[name]=input}};$.fn.editable.defaults={name:"value",id:"id",type:"text",width:"auto",height:"auto",event:"click.editable",onblur:"cancel",loadtype:"GET",loadtext:"Loading...",placeholder:"Click to edit",loaddata:{},submitdata:{},ajaxoptions:{}}})(jQuery);(function(a){a.fn.inputlimiter=function(b){var c=a.extend({},a.fn.inputlimiter.defaults,b);if(c.boxAttach&&!a("#"+c.boxId).length){a("<div/>").appendTo("body").attr({id:c.boxId,"class":c.boxClass}).css({position:"absolute"}).hide();if(a.fn.bgiframe){a("#"+c.boxId).bgiframe()}}a(this).each(function(d){a(this).unbind();a(this).keyup(function(k){if(a(this).val().length>c.limit){a(this).val(a(this).val().substring(0,c.limit))}if(c.boxAttach){a("#"+c.boxId).css({width:a(this).outerWidth()-(a("#"+c.boxId).outerWidth()-a("#"+c.boxId).width())+"px",left:a(this).offset().left+"px",top:(a(this).offset().top+a(this).outerHeight())-1+"px","z-index":2000})}var g=c.limit-a(this).val().length;var h=c.remTextFilter(c,g);var f=c.limitTextFilter(c);if(c.limitTextShow){a("#"+c.boxId).html(h+" "+f);var l=a("<span/>").appendTo("body").attr({id:"19cc9195583bfae1fad88e19d443be7a","class":c.boxClass}).html(h+" "+f).innerWidth();a("#19cc9195583bfae1fad88e19d443be7a").remove();if(l>a("#"+c.boxId).innerWidth()){a("#"+c.boxId).html(h+"<br />"+f)}a("#"+c.boxId).show()}else{a("#"+c.boxId).html(h).show()}});a(this).keypress(function(f){if((!f.keyCode||(f.keyCode>46&&f.keyCode<90))&&a(this).val().length>=c.limit){return false}});a(this).blur(function(){if(c.boxAttach){a("#"+c.boxId).fadeOut("fast")}else{if(c.remTextHideOnBlur){var e=c.limitText;e=e.replace(/\%n/g,c.limit);e=e.replace(/\%s/g,(c.limit==1?"":"s"));a("#"+c.boxId).html(e)}}})})};a.fn.inputlimiter.remtextfilter=function(d,b){var c=d.remText;if(b==0&&d.remFullText!=null){c=d.remFullText}c=c.replace(/\%n/g,b);c=c.replace(/\%s/g,(d.zeroPlural?(b==1?"":"s"):(b<=1?"":"s")));return c};a.fn.inputlimiter.limittextfilter=function(c){var b=c.limitText;b=b.replace(/\%n/g,c.limit);b=b.replace(/\%s/g,(c.limit<=1?"":"s"));return b};a.fn.inputlimiter.defaults={limit:255,boxAttach:true,boxId:"limiterBox",boxClass:"limiterBox",remText:"%n character%s remaining.",remTextFilter:a.fn.inputlimiter.remtextfilter,remTextHideOnBlur:true,remFullText:null,limitTextShow:false,limitText:"Field limited to %n character%s.",limitTextFilter:a.fn.inputlimiter.limittextfilter,zeroPlural:true}})(jQuery);var timekeeper={currentTime:null,movieStartTime:null,reviewStartTime:null,promoStartTime:null,qaStartTime:null,viewBlockTime:null,viewEndTime:null,currentPanel:"prescreening-panel",init:function(){timekeeper.currentTime=new Date().getTime()/1000;timekeeper.movieStartTime=$("#starttime").html();timekeeper.reviewStartTime=$("#reviewtime").html();timekeeper.promoStartTime=$("#promotime").html();timekeeper.qaStartTime=$("#qatime").html();timekeeper.viewBlockTime=$("#blockentrytime").html();timekeeper.viewEndTime=$("#endtime").html();toggleDiv("chat_panel")},poll:function(a){timekeeper.currentTime=a;switch(true){case (timekeeper.currentTime>timekeeper.viewEndTime):window.location.href="/film/"+$("#film").html()+"?code=exp";break;case ((timekeeper.currentTime>=timekeeper.movieStartTime)&&(timekeeper.currentTime<timekeeper.viewBlockTime)):if((timekeeper.currentTime>timekeeper.movieStartTime+5)&&($(".screening_wrapper").css("display")=="none")){$(".screening_wrapper").fadeIn()}timekeeper.startMovie();break;case ((timekeeper.currentTime>=timekeeper.movieStartTime)&&(timekeeper.currentTime>timekeeper.viewBlockTime)):videoplayer.hideVODPlayer();break;default:break}},checkMovieTime:function(){if((timekeeper.currentTime>timekeeper.movieStartTime)&&(timekeeper.currentTime<timekeeper.viewBlockTime)){return true}return false},startMovie:function(){if((timekeeper.currentPanel=="video_panel")&&(document.getElementById(videoplayer.div)!=undefined)){return}$("#status_panel").html("Status: Screening");timekeeper.currentPanel="video_panel";$("#timer_panel").fadeOut("slow");$("#prescreening_panel_main").fadeOut(100);$("#video_panel").fadeIn("slow");if(videoplayer.state=="pre"){if($("#noauth").length==0){videoplayer.initPlayer()}}},startReview:function(){if(timekeeper.currentPanel=="review_panel"){return}$("#status_panel").html("Status: Reviews");timekeeper.currentPanel="review_panel";$("#review_panel").fadeIn("slow")},startPromo:function(){if(timekeeper.currentPanel=="promo_panel"){return}$("#status_panel").html("Status: Promos");timekeeper.currentPanel="promo_panel";$("#review_panel").fadeOut("slow");$("#promo_panel").fadeIn("slow");promotions.init()},startQA:function(){if(timekeeper.currentPanel=="qa_panel"){return}$("#status_panel").html("Status: Q And A");timekeeper.currentPanel="qa_panel";qanda.allowScreeningClose();$("#promo_panel").fadeOut("slow")}};$(document).ready(function(){if(!window.console){window.console={}}if(!window.console.log){window.console.log=function(){}}timekeeper.init()});function getCookie(a){var b=document.cookie.match("\\b"+a+"=([^;]*)\\b");return b?b[1]:undefined}jQuery.fn.formToDict=function(){var a=this.serializeArray();var c={};for(var b=0;b<a.length;b++){c[a[b].name]=a[b].value}if(c.next){delete c.next}return c};jQuery.fn.disable=function(){this.enable(false);return this};jQuery.fn.enable=function(a){if(arguments.length&&!a){this.attr("disabled","disabled")}else{this.removeAttr("disabled")}return this};var activity={errorSleepTime:5000,cursor:null,host:null,port:null,instance:null,room:null,destination:null,user:null,users:null,registry:null,construct:function(){activity.host=$("#host").html();activity.port=parseInt($("#port").html())+13090;activity.instance=$("#instance").html();activity.room=$("#room").html();activity.film=$("#film").html();activity.destination=activity.host+":"+activity.port;activity.user=$("#userid").html();activity.users=new Array();activity.registry=new Array()},init:function(){if($("#noauth").length!=0){return}if(activity.room==""){return}var a={room:activity.room,instance:activity.instance,userid:activity.user,location:activity.location,cookie:$.cookie("constellation_frontend")};$.ajax({url:"/services/activity/init?i="+activity.destination,type:"GET",cache:false,dataType:"text",data:$.param(a),success:activity.onInitSuccess,error:activity.onInitError})},onInitSuccess:function(response){try{if(!response){return}var response=eval("("+response+")");activity.tempusers=new Array();for(var i=0;i<response.users.length;i++){if(response.users[i].userid!=undefined){activity.pushUser(response.users[i]);activity.showUser(response.users[i])}}if(activity.users.length>activity.tempusers.length){for(var i=0;i<activity.users.length;i++){activity.dropUser(activity.users[i])}}activity.showUserCount()}catch(e){console.log("Activity Error");activity.onInitError();return}},onInitError:function(a){console.log("Activity Init Error");window.setTimeout(activity.init,5000)},pushUser:function(a){if(a.userid==undefined){return}activity.tempusers.push(a.userid);if($.inArray(a.userid,activity.users)==-1){activity.users.push(a.userid);activity.registry[a.userid]=a.username}},dropUser:function(a,b){if($.inArray(a,activity.tempusers)==-1){activity.removeUser(a);delete activity.registry[a];activity.users=jQuery.grep(activity.users,function(c){return c!=a})}},announce:function(){if($("#noauth").length!=0){return}if(activity.room==""){return}var a={film:activity.film,room:activity.room,instance:activity.instance,userid:activity.user,location:activity.location,cookie:$.cookie("constellation_frontend")};$.ajax({url:"/services/activity/announce?i="+activity.destination,type:"POST",cache:false,dataType:"text",data:$.param(a),success:activity.onAnnounceSuccess,error:activity.onAnnounceError})},onAnnounceSuccess:function(response){try{var response=eval("("+response+")");activity.showUser(response.users[0]);activity.tempusers=new Array();activity.pushUser(response.users[0]);activity.showUserCount()}catch(e){activity.onAnnounceError();return}},onAnnounceError:function(a){console.log("Activity Announce Error");window.setTimeout(activity.announce,5000)},status:function(){if($("#noauth").length!=0){return}if(activity.room==""){return}try{var a="/services/activity/status?i="+activity.destination+"&room="+activity.room+"&userid="+activity.user+"&instance="+activity.instance+"&location="+activity.location+"&film="+activity.film+"&cookie="+$.cookie("constellation_frontend");$.head(a,{},function(c){$.each(c,function(d,g){if(d=="X-User-Get"){try{if(g!=activity.users.length){}}catch(f){}}if(d=="X-Server-Time"){try{timekeeper.poll(g)}catch(f){}}});window.setTimeout(activity.status,5000)},activity.errorSleepTime-2000)}catch(b){window.setTimeout(activity.status,5000)}},poll:function(){if($("#noauth").length!=0){return}if(activity.room==""){return}var a={room:$("#room").html(),userid:$("#userid").html(),location:activity.location,cookie:$.cookie("constellation_frontend")};$.ajax({url:"/services/activity/update?i="+activity.destination,type:"POST",cache:false,dataType:"text",data:$.param(a),timeout:activity.errorSleepTime,success:activity.onPollSuccess,error:activity.onPollError})},onPollSuccess:function(response){try{if(!response){return}var response=eval("("+response+")");for(var i=0;i<response.users.length;i++){activity.showUser(response.users[i],true)}}catch(e){activity.onAnnounceError();return}activity.errorSleepTime=100;window.setTimeout(activity.poll,0)},onPollError:function(a){console.log("Activity Poll error; sleeping for",activity.errorSleepTime,"ms");window.setTimeout(activity.poll,activity.errorSleepTime)},showUserCount:function(){if($("#userCount").length>0){$("#userCount").html(activity.users.length)}},showUser:function(b){if($("#adminmessage-users").length>0){var a="green";if(b.location=="lobby"){a="orange"}if($("#adminuser-"+b.userid).length>0){userdata='<a name="adminmessageuser-'+b.userid+'" id="adminmessageuser-'+b.userid+'" title="'+b.username+'" onClick="adminmessage.startAdminChat(this)"><img src="/images/Neu/8x8/status/online-'+a+'.png" /></a>';$("#adminuser-"+b.userid+"-status").html(userdata)}else{html='<div class="message" id="adminuser-'+b.userid+'"><span id="adminuser-'+b.userid+'-block"><a name="adminmessageuser-'+b.userid+'" id="blockmessageuser-'+b.userid+'" title="'+b.username+'" onClick="adminmessage.blockSeat(this)"><img src="/images/Neu/8x8/status/important.png" /></a></span><span id="adminuser-'+b.userid+'-status"><a name="adminmessageuser-'+b.userid+'" id="adminmessageuser-'+b.userid+'" title="'+b.username+'" onClick="adminmessage.electAdminChat(this)"><img src="/images/Neu/8x8/status/online-'+a+'.png" /></a></span><strong>'+b.username+"</strong></div>";$("#adminmessage-users").append(html)}}if($("#user-"+b.userid).length==0){var d=Math.floor(Math.random()*98);var c=Math.floor(Math.random()*121);html='<a style="position: relative; top: '+c+"px; left: "+d+'%;" name="constellation-'+b.userid+'" class="host-star" id="user-'+b.userid+'" title="'+b.username+'" onClick="privatechat.startPrivateChat(this)"><img src="/images/host-star.png" /></a>';$("#constellation_map").append(html)}},setUserLocation:function(c,d,a){var b="green";if(a=="lobby"){b="orange"}if($("#adminuser-"+userid).length>0){userdata='<a name="adminmessageuser-'+userid+'" id="adminmessageuser-'+userid+'" title="'+username+'" onClick="adminmessage.startAdminChat(this)"><img src="/images/Neu/8x8/status/online-'+b+'.png" /></a>';$("#adminuser-"+userid+"-status").html(userdata)}},removeUser:function(a){if($("#adminmessage-users").length==0){if($("#adminuser-"+a+"-status").length==0){$("#adminuser-"+a+"-status").html("Offline").attr("style","color:red")}}if(($("#user-"+a).length>0)&&(a!=$("#userid").html())){$("#user-"+a).remove()}}};$(document).ready(function(){if(!window.console){window.console={}}if(!window.console.log){window.console.log=function(){}}if(window.location.pathname.match(/theater/)){activity.location="theater"}if(window.location.pathname.match(/lobby/)){activity.location="lobby"}activity.construct();activity.announce();activity.status()});function newQAMessage(b){console.log("newQAMessage");if(qanda.showCount()){if((/Enter Your Message Here/.test($("#qandaform [name=body]").val()))||($("#qandaform [name=body]").val()=="")){$("#qa-message").html("Please enter a question. You have "+(qanda.totalquestions-$(".question").length)+" more questions.").css("color","red");return false}var a=b.formToDict();console.log("Postin!");$.postQandAJSON("/services/qanda/post",a,function(c){qanda.showMessage(c);if(a.id){b.parent().remove()}else{$("#qandaform [name=body]").val("")}})}}jQuery.postQandAJSON=function(url,args,callback){args.room=$("#room").html();args.author=$("#userid").html();$.ajax({url:url+"?i="+$("#host").html()+":"+(parseInt($("#port").html())+15090),data:$.param(args),type:"POST",cache:false,dataType:"text",success:function(response){if(callback){callback(eval("("+response+")"))}},error:function(response){}})};var qanda={totalquestions:4,errorSleepTime:900000,watermark:"Enter Your Message Here",currentquestions:0,pollRunning:true,slideRunning:true,host:null,port:null,instance:null,room:null,destination:null,user:null,inbox:null,listbox:null,selected_inbox:null,scroller:null,inbox:null,qanda_showing:false,construct:function(){qanda.host=$("#host").html();qanda.port=parseInt($("#port").html())+15090;qanda.instance=$("#instance").html();qanda.room=$("#room").html();qanda.screening=$("#qscreening_id").html();qanda.destination=qanda.host+":"+qanda.port;qanda.user=$("#userid").html();qanda.inbox=$("#qanda-inbox");qanda.listbox=$("#qa_list");qanda.selected_inbox=$("#qanda-inbox").html()},init:function(){$(".qa_pop_up .popup-close").click(function(b){toggleDiv("qanda_panel")});$("#qanda_switch").click(function(b){toggleDiv("qanda_panel")});$("#host_screening_webcam").click(function(b){if($("#host_screening_webcam").val()=="disable webcam"){if(typeof videoplayer!=undefined){if($("#is_host").length>0){videoplayer.hideHostCam()}}$("#host_screening_webcam").val("enable webcam")}else{if(typeof videoplayer!=undefined){if($("#is_host").length>0){videoplayer.showHostCam()}}$("#host_screening_webcam").val("disable webcam")}});$("#host_screening_refresh").click(function(b){qanda.getCurrent()});$("#host_screening_qanda").click(function(b){toggleDiv("qanda_panel")});$("#qa_panel h4").click(function(b){toggleDiv("qanda_panel")});if($("#qandaform").length>0){console.log("#qandaform submit");$("#qandaform").submit(function(){if(($("#qanda_message").val()==qanda.watermark)||($("#qanda_message").val()=="")){return false}newQAMessage($("#qandaform"));$("#qanda_message").val("");return false});$("#qanda-submit").click(function(b){if(($("#qanda_message").val()==qanda.watermark)||($("#qanda_message").val()=="")){return false}b.stopPropagation();newQAMessage($("#qandaform"));$("#qanda_message").val("");return false});$("#qanda_message").select();$("#qanda_message").watermark(qanda.watermark);qanda.showCount();qanda.slidePoll();qanda.setQuestionCount()}if($("#qanda-host-inbox").length>0){console.log("Setting Up JScroller for QandA");var a=$("#qanda-host-inbox").jScrollPane({verticalDragMinHeight:10,verticalDragMaxHeight:10,verticalGutter:0});qanda.inbox=$("#qanda-host-inbox .jspPane");qanda.scroller=a.data("jsp")}if($("#answerform").length>0){$("#answerform").live("submit",function(){qanda.postSlide();return false});$("#answer-submit").click(function(b){qanda.postSlide();return false})}},setQuestionCount:function(){qanda.currentquestions=$("#qanda-host-selected-inbox li").length+$("#qanda-host-inbox li").length},showMessage:function(c){console.log("Showing Message");var b=$("#q"+c.id);if(b.length>0){return}for(amess in c.questions){console.log(unescape(c.questions[amess].html));var a=$(unescape(c.questions[amess].html));qanda.inbox.append(a);var d='<li id="qe-'+c.questions[amess].id+'">'+unescape(c.questions[amess].body)+"</li>";qanda.listbox.append(d);qanda.showCount()}},showCount:function(){if($("#qanda-inbox .question").length>qanda.totalquestions){$("#qa-message").html("You have asked all of your "+qanda.totalquestions+" questions.").css("color","red");return false}else{$("#qa-message").html("You have "+(qanda.totalquestions-$("#qanda-inbox .question").length)+" more questions.");return true}},status:function(){if(qanda.destination==undefined){return}$.head("/services/qanda/status?i="+qanda.destination+"&screening="+qanda.screening+"&userid="+qanda.user,{},function(a){$.each(a,function(b,d){if(b=="X-Question-Get"){try{if(d!=qanda.currentquestions){qanda.poll()}}catch(c){}}if(b=="X-Server-Time"){try{timekeeper.poll(d)}catch(c){console.log("No Timer Available")}}});window.setTimeout(qanda.status,5000)})},poll:function(){var a={screening:qanda.screening,room:qanda.room,instance:qanda.instance,userid:qanda.user};$.ajax({url:"/services/qanda/history?i="+qanda.destination,type:"GET",cache:false,dataType:"text",data:$.param(a),success:qanda.onSuccess,error:qanda.onError})},onSuccess:function(response){response=eval("("+response+")");if(!response.questions){return}var questions=response.questions;console.log(questions.length,"new qanda messages");for(var i=0;i<questions.length;i++){if(questions[i].room==qanda.room){var existing=$("#q"+questions[i].id);if(existing.length>0){continue}var node=$(questions[i].html);qanda.inbox.prepend(node);qanda.scroller.reinitialise()}}qanda.setQuestionCount();if(qanda.pollRunning){}},slidePoll:function(){var a={room:qanda.room};$.ajax({url:"/services/qanda/update?i="+qanda.destination,type:"POST",cache:false,dataType:"text",data:$.param(a),timeout:qanda.errorSleepTime,success:qanda.onSlideSuccess,error:qanda.onError})},onSlideSuccess:function(response){try{response=eval("("+response+")");if(!response.questions){return}var questions=response.questions;for(var i=0;i<questions.length;i++){console.log("Question ID: "+questions[i].id);if((questions[i].id==0)&&($("#qa_showing_list li").length>0)){qanda.onSuccess(quesions[i])}else{if(questions[i].id==-1){console.log("Clearing Questions");$("#qa_showing_list li").remove()}else{if(questions[i].id==-2){if(($("#is_host").length==0)&&(!qanda.qanda_showing)){console.log("Restarting Host Stream");if(videoplayer!=undefined){videoplayer.camViewerReStart()}}}else{if(questions[i].id==-3){console.log("qanda_showing is "+qanda.qanda_showing);console.log("IS HOST is "+$("#is_host").length);if(($("#is_host").length==0)&&(qanda.qanda_showing)){console.log("Stopping Host Stream");if(videoplayer!=undefined){videoplayer.hideLiveViewer()}}}else{if((questions[i].room==qanda.room)&&(questions[i].id!=0)&&($("#qs-"+questions[i].id).length==0)){html='<li id="qs-'+questions[i].id+'">'+questions[i].html+"</li>";$("#qa_showing_list li").remove();$("#qa_showing_list").append(html)}}}}}}}catch(e){qanda.onError();return}window.setTimeout(qanda.slidePoll,0)},onError:function(){window.setTimeout(qanda.slidePoll,qanda.errorSleepTime)},closeInput:function(){qanda.pollRunning=false;qanda.closeQandA();$("#qanda-host-inbox, #qanda-host-selected-inbox").sortable("destroy");$("#qanda-host-selected-inbox .handle img").attr("src","/images/dnd-go.png");$("#qanda-host-inbox .handle img").attr("src","/images/dnd-stop.png");$("#qanda-host-selected-inbox .handle img").click(function(a){a.stopPropagation();qanda.showSlide($(this).closest("li").attr("id"))})},killQandA:function(){var a={room:qanda.room,instance:qanda.instance};$.ajax({url:"/services/qanda/close?i="+qanda.destination,type:"GET",cache:false,dataType:"text",data:$.param(a)})},showSlide:function(b){var a={room:qanda.room,instance:qanda.instance,screening:qanda.screening,question:b};$("#q"+b+" table tr > td:nth-child(1) img").attr("src","/images/dnd-stop.png");$.ajax({url:"/services/qanda/slide?i="+qanda.destination,type:"GET",cache:false,dataType:"json",data:$.param(a),success:function(c){if($("#qe-"+c.id).length==0){html='<li id="qe-'+c.id+'">'+c.html+"</li>";$("#qa_showing_list li").remove();$("#qa_showing_list").append(html)}}})},clearSlides:function(){$("#qa_showing_list li").remove();var a={room:qanda.room,instance:qanda.instance,screening:qanda.screening,message:-1};$.ajax({url:"/services/qanda/message?i="+qanda.destination,type:"GET",cache:false,dataType:"json",data:$.param(a),success:function(b){}})},publishHost:function(){console.log("Republishing Host Stream");var a={room:qanda.room,instance:qanda.instance,screening:qanda.screening,message:-2};$.ajax({url:"/services/qanda/message?i="+qanda.destination,type:"GET",cache:false,dataType:"json",data:$.param(a),success:function(b){}})},unpublishHost:function(){console.log("Unpublishing Host Stream");var a={room:qanda.room,instance:qanda.instance,screening:qanda.screening,message:-3};$.ajax({url:"/services/qanda/message?i="+qanda.destination,type:"GET",cache:false,dataType:"json",data:$.param(a),success:function(b){}})},allowScreeningClose:function(){$("#host_screening_end").fadeIn("slow");$("#host_screening_end_also").fadeIn("slow")},getCurrent:function(){var a={room:qanda.room,screening:qanda.screening};$.ajax({url:"/services/qanda/current?i="+qanda.destination,type:"POST",cache:false,dataType:"text",data:$.param(a),timeout:qanda.errorSleepTime,success:qanda.onCurrentSuccess,error:qanda.onCurrentError})},onCurrentSuccess:function(response){console.log("Current Success");response=eval("("+response+")");if($("#qe-"+response.id).length==0){html='<li id="qe-'+response.id+'">'+response.html+"</li>";$("#qa_showing_list li").remove();$("#qa_showing_list").append(html)}},onCurrentError:function(){console.log("Current Error");window.setTimeout(qanda.getCurrent,5000)}};$(document).ready(function(){if(!window.console){window.console={}}if(!window.console.log){window.console.log=function(){}}qanda.construct()});var videoplayer={state:"pre",div:"none",volume:5,is_mute:false,trailer:41,version:"2.48-Uncomp",file:null,autoplay:null,videoHidden:0,startTime:0,errorSleepTime:5000,init:function(){$("#mute").click(function(){videoplayer.toggleMute()});$("#fullscreen").click(function(){videoplayer.fullscreen()});videoplayer.setSoundControl()},initPlayer:function(){videoplayer.setVODControls($("#video").html())},setVODControls:function(f){videoplayer.file=f;var e={k:$("#video_data").html()};videoplayer.state="playing";videoplayer.div="cPlayer";if($("#runtime").html()>0){var b=$("#runtime").html()}else{var b=0}var d=new Date().getTime();if(timekeeper!=undefined){var g=timekeeper.currentTime+1}else{var g=new Date().getTime()/1000}var a={src:videoplayer.file,autostart:true,debugConsole:"false",delaySeek:"3",csrc:$("#csrc").html(),seekInto:b,filmStartTime:$("#starttime").html(),ticketParams:$("#video_data").html(),streamName:$("#room").html()+"_stream",slist:$("#film").html(),bitrates:$("#bitrates").html(),fileType:$("#movie_type").html(),sip:$("#host").html(),sprt:parseInt($("#port").html())+16090,timestamp:g,showTimeDebug:false,showTimeDebugInterval:10,zeroFPSLimit:30,logLevel:3};var h={allowFullScreen:"true",allowScriptAccess:"always",wmode:"direct",bgcolor:"#000000"};var c={id:"cPlayer",name:"cPlayer"};videoplayer.div="cPlayer";swfobject.embedSWF("/flash/Constellation_Player_secure.swf?v="+videoplayer.version,"movie_stream","100%","100%","10.1.0","/flash/expressInstall.swf",a,h,c)},hideVODPlayer:function(){try{if(swfobject!=undefined){swfobject.removeSWF("cPlayer");$("#video_stream").append('<div id="movie_stream" class="nx_widget_player">')}}catch(a){}},pushLogLevel:function(b){var a={body:"hostset:setLogLevel|hostval:"+b};$.postJSON("/services/chat/post",a)},setLogLevel:function(b){vals=b.html.split("|");var a=vals[0].split(":");var c=vals[1].split(":");console.log("setting new value of "+a[1]+" "+c[1]);if(document.getElementById("cPlayer")!=undefined){document.getElementById("cPlayer").setLogLevel(c[1])}},showHostCam:function(){if(swfobject!=undefined){videoplayer.setHOSTControls();$(".show_hostcam").hide(100);$(".hide_hostcam").show(100);if(qanda!=undefined){qanda.qanda_showing=true}}},hideHostCam:function(){try{if(swfobject!=undefined){swfobject.removeSWF("myHost");$(".qanda_box").append('<div id="host_stream" class="nx_widget_player"></div>');$(".hide_hostcam").hide(100);$(".show_hostcam").show(100);if(qanda!=undefined){qanda.qanda_showing=false}}}catch(a){}},camHostReStart:function(){videoplayer.videoHidden=0;swfobject.removeSWF("myHost");$(".qanda_box").append('<div id="host_stream" class="nx_widget_player"></div>');videoplayer.setHOSTControls();if(qanda!=undefined){qanda.qanda_showing=true}},setHOSTControls:function(){var a={host:$("#userid").html()};$.ajax({url:"/services/HUD/get",type:"GET",cache:false,dataType:"json",data:$.param(a),timeout:videoplayer.errorSleepTime,success:function(b){videoplayer.startHOST(b)},error:videoplayer.setHOSTControls})},startHOST:function(d){var e=d.hudSettings;if($("#hostserver").html()!="akamai"){var b="recordHostCamera.swf";var f="rtmp://"+$("#hostserver").html()+".rtmp.constellation.tv/live/"}else{var b="HostCam.swf";var f="rtmp://p.ep45907.i.akamaientrypoint.net/EntryPoint/"}var a={src:videoplayer.file,debugConsole:"false",ticketParams:$("#video_data").html(),streamName:$("#room").html()+"_stream",slist:$("#film").html(),sip:$("#host").html(),bandwidthLimit:e.bandwidthLimit,qualityLevel:e.qualityLevel,keyFrameInterval:e.keyFrameInterval,captureFps:e.captureFps,bufferMin:e.bufferMin,bufferMax:e.bufferMax,micRate:e.micRate,micGain:e.micGain,motionTimeout:e.motionTimeout,echoSuppression:e.echoSuppression,enhancedMicrophone:e.enhancedMicrophone,silenceLevel:e.silenceLevel,micSilenceTimeout:e.micSilenceTimeout,enableVAD:e.enableVAD,recordURL:f};var g={allowFullScreen:"true",allowScriptAccess:"always",wmode:"opaque",bgcolor:"#000000"};var c={id:"myHost",name:"myHost"};swfobject.embedSWF("/flash/"+b,"host_stream","290","220","10.1.0","/flash/expressInstall.swf",a,g,c)},message:function(a,c,b){if(videoplayer.state=="playing"){if(document.getElementById(videoplayer.div)!=undefined){document.getElementById(videoplayer.div).displayMessage(a,c,b)}}},resize:function(){if(videoplayer.state=="playing"){if(document.getElementById(videoplayer.div)!=undefined){document.getElementById(videoplayer.div).resizeNotification()}}},toggleMute:function(){if(!videoplayer.is_mute){videoplayer.is_mute=true;videoplayer.mute()}else{videoplayer.is_mute=false;videoplayer.unmute()}},mute:function(){$("#mute").css("backgroundPosition","-20px 0px");$(".volume_bar").css("backgroundPosition","-104px 0px");if((document.getElementById(videoplayer.div)!=undefined)&&(videoplayer.state=="playing")){document.getElementById(videoplayer.div).setVolume(0)}videoplayer.unsetSoundControl()},unmute:function(){if((document.getElementById(videoplayer.div)!=undefined)&&(videoplayer.state=="playing")){document.getElementById(videoplayer.div).setVolume(videoplayer.volume)}$("#mute").css("backgroundPosition","0px 0px");$(".volume_bar").css("backgroundPosition","0px 0px");videoplayer.setSoundControl()},setFocus:function(){if(document.getElementById(videoplayer.div)!=undefined){document.getElementById(videoplayer.div).focus()}},showLiveViewer:function(){videoplayer.videoHidden=0;try{if(swfobject!=undefined){videoplayer.setVIEWControls();$(".show_hostcam").hide(100);$(".hide_hostcam").show(100);if(qanda!=undefined){qanda.qanda_showing=true}}}catch(a){}},camViewerReStart:function(){videoplayer.videoHidden=0;swfobject.removeSWF("myViewer");$(".qanda_box").append('<div id="host_stream" class="nx_widget_player"></div>');videoplayer.setVIEWControls();if(qanda!=undefined){qanda.qanda_showing=true}},hideLiveViewer:function(){videoplayer.videoHidden++;if(videoplayer.videoHidden>5){return}try{if(swfobject!=undefined){swfobject.removeSWF("myViewer");$(".qanda_box").append('<div id="host_stream" class="nx_widget_player"></div>');$(".hide_hostcam").hide(100);$(".show_hostcam").show(100);if(qanda!=undefined){qanda.qanda_showing=false}}}catch(a){}},setVIEWControls:function(){var c={k:$("#video_data").html()};var a={src:videoplayer.file,debugConsole:"false",ticketParams:$("#video_data").html(),streamName:$("#room").html()+"_stream",slist:$("#film").html(),sip:$("#host").html()};var d={allowFullScreen:"true",allowScriptAccess:"always",wmode:"opaque",bgcolor:"#000000"};var b={id:"myViewer",name:"myViewer"};swfobject.embedSWF("/flash/LiveStream.swf","host_stream","290","220","10.1.0","/flash/expressInstall.swf",a,d,b)},unsetSoundControl:function(){$("#slider").slider("destroy")},setSoundControl:function(){$("#slider").slider({value:videoplayer.volume,max:10,min:0,step:1,slide:function(a,b){videoplayer.volume=b.value;if((document.getElementById(videoplayer.div)!=undefined)&&(videoplayer.state=="playing")){document.getElementById(videoplayer.div).setVolume(b.value)}}})},fullscreen:function(){if((document.getElementById(videoplayer.div)!=undefined)&&(videoplayer.state=="playing")){document.getElementById(videoplayer.div).goFullscreen()}},setVolume:function(a){$("#slider").slider("value",(a*10))}};function setCurrentTime(a){$("#seektime").html(Math.round(a))}$(document).ready(function(){if(!window.console){window.console={}}if(!window.console.log){window.console.log=function(){}}videoplayer.init();if($("#video-type").html()=="TRAILER"){videoplayer.initPlayer()}});var colorme={user:null,post:null,posl:null,icon:null,userElement:null,animating:false,status:null,imagesize:null,imagesmall:28,imagelarge:50,scrollsize:64,currentwidth:0,COLORMES:null,isSmall:false,userOffset:0,usersCollection:{},isUpdated:false,init:function(){colorme.COLORMES=[];colorme.imagesize=colorme.imagelarge;colorme.screeningId=$("#screening_id").html();this.attachPoints();this.attachEvents();colorme.attachTip();if(colorme.user!=0){colorme.attachColorMeIcons()}colorme.shortBox();colorme.user=$("#userid").html();colorme.currentwidth=($(window).width()-440);$(".userblock").width(colorme.currentwidth);colorme.updatePagination()},attachPoints:function(){colorme.nextButton=$("#user_wrap_right");colorme.previousButton=$("#user_wrap_left");colorme.theaterIconContainer=$("#theater_icons");colorme.inboxContainer=$("#inbox ")},attachEvents:function(){colorme.nextButton.bind("click",colorme.nextClick);colorme.previousButton.bind("click",colorme.previousClick);$(window).bind("resize",colorme.resize)},attachColorMeIcons:function(){$(".color_icon").bind("click",colorme.onColorMeClick)},onColorMeClick:function(b,c){colorme.icon=$(this).attr("class").replace("color_icon ","");colorme.animateIcon(colorme.user,colorme.icon);colorme.status=colorme.icon;var a={body:"colorme:"+colorme.icon};$.postJSON("/services/chat/post",a,colorme.finishPost)},attachTip:function(){colorme.toolTip=$('<div class="tooltip theater-user-tip theater-user-tip-footer"></div>');$("#footer").append(colorme.toolTip);$("#footer .colorme_user").live("mouseover",colorme.onUserMouseover)},onUserMouseover:function(){if(colorme.toolTipTarget){colorme.toolTipTarget.unbind("mouseleave");colorme.toolTip.clearQueue()}colorme.toolTipTarget=$(this);var a=colorme.toolTipTarget.parents(".theater_icon").position();colorme.toolTipTarget.bind("mouseleave",colorme.onUserMouseleave);colorme.toolTip.stop().css({top:a.top-60,left:a.left+10+parseInt(colorme.theaterIconContainer.css("left")),display:"block"}).animate({opacity:1},100).html(colorme.toolTipTarget.attr("alt"))},onUserMouseleave:function(){colorme.toolTip.animate({opacity:0},100,function(){colorme.toolTip.css({display:"none"})})},getCurrentUsers:function(c){if(colorme.getCurrentUserTimer){window.clearTimeout(colorme.getCurrentUserTimer)}var a,b;if(colorme.isSmall){b=colorme.userOffset*2;a=Math.ceil(colorme.currentwidth/16);if(a%2!=0){a++}}else{b=colorme.userOffset;a=Math.ceil(colorme.currentwidth/64)}$.ajax({url:"/services/Screenings/colorme?screening="+colorme.screeningId+"&records="+a+"&offset="+b,type:"GET",cache:false,dataType:"json",timeout:3000,success:colorme.onGetCurrentUsersSuccess,error:function(){colorme.isUpdated=true}});colorme.getCurrentUserTimer=window.setTimeout(colorme.getCurrentUsers,10000)},onGetCurrentUsersSuccess:function(b){if((typeof b=="object")&&b.users){if(b.totalresults!=colorme.totalresults){colorme.usersCollection={};colorme.theaterIconContainer.empty()}colorme.totalresults=b.totalresults;colorme.isSmall=b.totalresults>50;var a=true;var g=[];for(var e=0;e<b.users.length;e++){if(!colorme.usersCollection["user_"+b.users[e].userid]){var d={opacity:0};if(colorme.isSmall){d.top=a?0:32;d.left=a?(e+(colorme.userOffset*2))*16:(e-1+(colorme.userOffset*2))*16}else{d.top=0;d.left=(e+colorme.userOffset)*64}var c=$('<div class="theater_icon" id="user_wrap_'+b.users[e].userid+'"><a href="/profile/'+b.users[e].userid+'" target="_blank"><img class="colorme_user" id="user_image_'+b.users[e].userid+'" src="'+b.users[e].image+'" alt="'+b.users[e].username+'" width="'+colorme.imagesize+'" /></a></div>').css(d).appendTo(colorme.theaterIconContainer);c.animate({opacity:1},300);colorme.usersCollection["user_"+b.users[e].userid]=c;a=!a}g.push("user_"+b.users[e].userid)}for(var e in colorme.usersCollection){if(_.indexOf(g,e)==-1){colorme.usersCollection[e].remove();delete colorme.usersCollection[e]}}if(colorme.isSmall){var f=colorme.totalresults/2*(colorme.imagesize+4);colorme.theaterIconContainer.css("width",f+"px")}else{var f=colorme.totalresults*(colorme.imagesize+14);colorme.theaterIconContainer.css("width",f+"px")}colorme.boxSwitch();colorme.drawColorMes();$(".userblock").fadeIn(100);colorme.updatePagination()}else{if((typeof b=="object")&&b.users==null){colorme.reset();colorme.getCurrentUsers()}}colorme.isUpdated=true},nextClick:function(){if(colorme.isUpdated){colorme.isUpdated=false;colorme.userOffset++;colorme.animateIconContainer()}},previousClick:function(){if(colorme.userOffset!=0&&colorme.isUpdated){colorme.isUpdated=false;colorme.userOffset--;colorme.animateIconContainer()}},animateIconContainer:function(){colorme.theaterIconContainer.animate({left:-1*(colorme.userOffset*(colorme.isSmall?32:64))},100,function(){colorme.getCurrentUsers()})},updatePagination:function(){if(colorme.userOffset==0){colorme.previousButton.fadeOut()}else{colorme.previousButton.fadeIn()}var a=Math.floor(colorme.currentwidth/(colorme.isSmall?16:64))+(colorme.userOffset*(colorme.isSmall?2:1));if((a>=colorme.totalresults)||Math.floor(colorme.currentwidth/(colorme.isSmall?16:64))>colorme.totalresults){colorme.nextButton.fadeOut()}else{colorme.nextButton.fadeIn()}},initColors:function(a){if(a!=undefined){usobj=a.split(",");for(i=0;i<usobj.length;i++){user=usobj[i].split("|");if((user[0]!=undefined)&&(user[1]!=undefined)){colorme.COLORMES[user[0]]=user[1].replace("colorme:","")}}colorme.drawColorMes()}},drawColorMes:function(){for(key in colorme.COLORMES){if(key!=""){colorme.setColor(key,colorme.COLORMES[key])}}},animateIcon:function(a,b){if(colorme.animating==false){colorme.animating=true;$("#color_node_"+a).remove();nclass=colorme.setColor(a,b);colorme.COLORMES[a]=b;var c=$('<img id="color_node_'+a+'" class="'+nclass+'" src="/images/alt1/'+b+'_icon.png" />').appendTo($("#user_wrap_"+a,colorme.theaterIconContainer));c.animate({opacity:0,top:"-=50"},1500,function(){c.remove()});colorme.animating=false}},setColor:function(a,b){$("#user_wrap_"+a,colorme.theaterIconContainer).removeClass("happy sad wow none heart quest").addClass(b);$(".chat_icon_user_"+a,colorme.inboxContainer).removeClass("happy_med sad_med wow_med none_med heart_med quest_med").addClass(b+"_med");var c="color_node";if(colorme.imagesize==colorme.imagesmall){c="color_node_small"}return c},resize:function(){if(colorme.getCurrentUserTimer){window.clearTimeout(colorme.getCurrentUserTimer)}if(!colorme.previousButton){colorme.attachPoints()}colorme.currentwidth=($(window).width()-440);$(".userblock").width(colorme.currentwidth);colorme.updatePagination();colorme.getCurrentUserTimer=window.setTimeout(colorme.getCurrentUsers,200)},boxSwitch:function(){if(colorme.totalresults>50&&colorme.imagesize!=colorme.imagesmall){colorme.tallBox()}else{if(colorme.totalresults<50&&colorme.imagesize==colorme.imagesmall){colorme.shortBox()}}},tallBox:function(){if(!colorme.theaterIconContainer){colorme.attachPoints()}colorme.theaterIconContainer.css("left","0px").removeClass("large-icons").addClass("small-icons");colorme.imagesize=colorme.imagesmall;colorme.scrollsize=colorme.imagesmall+4;colorme.reset();colorme.getCurrentUsers()},shortBox:function(){if(!colorme.theaterIconContainer){colorme.attachPoints()}colorme.theaterIconContainer.css({top:"0px",left:"0px"}).removeClass("small-icons").addClass("large-icons");colorme.imagesize=colorme.imagelarge;colorme.scrollsize=colorme.imagelarge+14;colorme.reset();colorme.getCurrentUsers()},reset:function(){colorme.userOffset=0;colorme.usersCollection={};colorme.theaterIconContainer.empty()},finishPost:function(a){},incomingMessage:function(a){regexp=new RegExp("colorme:(.+)</p>");iconObj=regexp.exec(a.html);colorme.animateIcon(a.author,iconObj[1])}};$(document).ready(function(){if(!window.console){window.console={}}if(!window.console.log){window.console.log=function(){}}colorme.init()});function newMessage(b){var a=b.formToDict();if((/Enter Your Message Here/.test($("#messageform [name=body]").val()))||($("#messageform [name=body]").val()=="")){return false}if(chat.allow_input==false){return}chat.blockInput();$.postJSON("/services/chat/post",a,function(c){if(a.id){b.parent().remove()}$("#messageform [name=body]").val("");chat.allowInput();chat.onReplyCancel();chat.scrollToBottom(true)})}function getCookie(a){var b=document.cookie.match("\\b"+a+"=([^;]*)\\b");return b?b[1]:undefined}jQuery.fn.setCursorPosition=function(a){this.each(function(c,d){if(d.setSelectionRange){d.setSelectionRange(a,a)}else{if(d.createTextRange){var b=d.createTextRange();b.collapse(true);b.moveEnd("character",a);b.moveStart("character",a);b.select()}}});return this};jQuery.postJSON=function(url,args,callback){args.room=$("#room").html();args.instance=$("#instance").html();args.author=$("#userid").html();args.cookie=$.cookie("constellation_frontend");args.film=$("#film").html();args.user_image=$("#user_image").html();args.ishost=$("#is_host").length;args.mdt=$("#moderator").length;args.cmo=$("#cmo").html();if(!!$("#chat-reply-id").value){args.c=$("#chat-reply-id").value}$.ajax({url:url+"?i="+$("#host").html()+":"+(parseInt($("#port").html())+9090),data:$.param(args),type:"POST",cache:false,dataType:"text",success:function(response){if(response){if(callback){callback(eval("("+response+")"))}}},error:function(response){}})};jQuery.fn.formToDict=function(){var a=this.serializeArray();var c={};for(var b=0;b<a.length;b++){c[a[b].name]=a[b].value}if(c.next){delete c.next}return c};jQuery.fn.disable=function(){this.enable(false);return this};jQuery.fn.enable=function(a){if(arguments.length&&!a){this.attr("disabled","disabled")}else{this.removeAttr("disabled")}return this};var chat={location:null,errorSleepTime:150000,cursor:null,host:null,port:null,instance:null,room:null,destination:null,inbox:null,scroller:null,watermark:"Enter Your Message Here:",started:false,mode:"tall",allow_input:true,blockScroll:false,scrollTimer:null,sequence:0,initPoll:false,construct:function(){chat.proxy="http://"+$("#proxy").html();chat.cookie=$.cookie("constellation_frontend");chat.host=$("#host").html();chat.port=parseInt($("#port").html())+9090;chat.instance=$("#instance").html();chat.room=$("#room").html();chat.destination=chat.host+":"+chat.port;if(window.location.pathname.match(/theater/)){chat.location="theater"}if(window.location.pathname.match(/screening/)){chat.location="screening"}if(window.location.pathname.match(/lobby/)){chat.location="lobby"}if($("#messageform").length>0){$("#messageform").submit(function(){if(($("#message").val()==chat.watermark)||($("#message").val()=="")){return false}newMessage($("#messageform"));$("#message").val("");return false});$("#chat-submit").click(function(a){if(($("#message").val()==chat.watermark)||($("#message").val()=="")){return false}a.stopPropagation();newMessage($("#messageform"));$("#message").val("");return false});$("#reply-submit").click(function(a){if(($("#message").val()==chat.watermark)||($("#message").val()=="")){return false}a.stopPropagation();newMessage($("#messageform"));$("#message").val("");return false});$("#chat_panel").click(function(a){});$("#message").select()}chat.inbox=$("#chat_panel #inbox");$(window).resize(function(){chat.resize()});if($("#chat_refresh").length>0){$("#chat_refresh").click(function(a){chat.inbox.html("");chat.init();return false})}$("#inbox").mouseup(function(a){chat.checkScroll()});$(".chat_reply",chat.inbox).live("click",chat.onReply);$(".chat_vote",chat.inbox).live("click",chat.onVote);$("#chat-reply-cancel").bind("click",chat.onReplyCancel)},init:function(){if($("#noauth").length!=0){}var a={instance:chat.instance,room:chat.room,cookie:chat.cookie,mdt:$("#moderator").length,cmo:$("#cmo").html(),s:chat.sequence};$.ajax({url:"/services/chat/init?i="+chat.destination,type:"GET",cache:false,dataType:"json",data:$.param(a),success:chat.onInitSuccess,error:chat.onInitError})},onInitSuccess:function(a){if((a!=null)&&(a.html!="undefined")){chat.inbox.append(a.html);chat.scrollToBottom()}if((a!=null)&&(a.colorme!="undefined")&&(colorme!="undefined")){colorme.initColors(a.colorme)}chat.resize();chat.started=true;if((a!=null)&&(a.sequence!="undefined")){chat.sequence=a.sequence}},onInitError:function(a){window.setTimeout(chat.init,5000)},poll:function(){if(!chat.started){window.setTimeout(chat.poll,3000);return}if($("#noauth").length!=0){}var a={instance:chat.instance,room:chat.room,cookie:chat.cookie,mdt:$("#moderator").length,cmo:$("#cmo").html()};$.ajax({url:"/services/chat/update?i="+chat.destination,type:"POST",cache:false,dataType:"text",data:$.param(a),timeout:chat.errorSleepTime,success:chat.onSuccess,error:chat.onError})},onSuccess:function(response){try{chat.newMessages(eval("("+response+")"))}catch(e){chat.onError();return}window.setTimeout(chat.poll,100);chat.scrollToBottom(chat.initPoll);chat.initPoll=false},onError:function(a){window.setTimeout(chat.poll,100)},checkScroll:function(){chat.blockScroll=true;chat.scrollTimer=window.setTimeout(chat.allowScroll,20000)},allowScroll:function(){chat.blockScroll=false;clearTimeout(chat.scrollTimer)},newMessages:function(b){if(!b.messages){return}var d=b.messages;var a=d[0].sequence-1;if(a!=chat.sequence){chat.init()}else{for(var c=0;c<d.length;c++){if(d[c].room==chat.room){chat.showMessage(d[c])}}}},showMessage:function(c){if(((c.colorme!=undefined)&&(c.colorme=="1"))||((c.html!=undefined)&&(c.html.substring(0,7)=="colorme"))){if(colorme!=undefined){colorme.incomingMessage(c)}return}if((c.html!=undefined)&&(c.html.substring(0,7)=="hostset")){if((videoplayer!=undefined)&&(/setLogLevel/.test(c.html))){videoplayer.setLogLevel(c);return}if(HUD!=undefined){HUD.incomingMessage(c)}return}var b=$("#m"+c.id);if(b.length>0){b.remove()}var a=$(c.html);if((chat.location=="screening")||(chat.location=="theater")){$("#chat_panel #inbox").append(a);chat.sequence=c.sequence;chat.resize()}else{$("#constellation_map").append(html);chat.remove()}},remove:function(){var a=19;if($("#constellation_map div").length>a){for(i=a;i<=$("#constellation_map div").length;i++){$("#constellation_map div:nth-child("+i+")").remove()}}},zebra:function(){$("#inbox div:odd").addClass("chat_message_1")},resize:function(){if($("#chat_panel").css("display")=="block"){chat.zebra();if(chat.mode=="tall"){var a=($(window).height()-246)}else{var a=($(window).height()-500)}$("#inbox").height(a);if(!chat.blockScroll){$("#inbox").animate({scrollTop:$("#inbox").attr("scrollHeight")},100)}}else{if($("#qanda_panel").css("display")=="block"){var a=($(window).height()-350);$("#qanda_panel").css("top",a+"px")}}return},scrollToBottom:function(b){var c=chat.inbox.prop("scrollHeight");var d=chat.inbox.prop("scrollTop");var a=chat.inbox.height();if(!!b||c-a-d<200){chat.inbox.prop({scrollTop:c})}},getRooms:function(){var a={room:chat.room,instance:chat.instance};$.ajax({url:"/services/chat/rooms?i="+chat.destination,type:"GET",cache:false,dataType:"json",data:$.param(a),success:function(b){var c="";for(i=0;i<b.rooms.length;i++){if(b.rooms[i].key!=undefined){if((b.rooms[i].name==undefined)||(b.rooms[i].name=="")){b.rooms[i].name=b.rooms[i].key}c+='<li><a href="javascript:void(0);" onclick="chat.switchRoom(this)" title="'+b.rooms[i].key+'">Chat Room '+b.rooms[i].name+"</a></li>"}}if(c!=""){$("#chatroom-instances").html(c)}}})},switchRoom:function(a){if($("#instance").html()!=a.getAttribute("title")){$("#instance").html(a.getAttribute("title"));chat.inbox.html("");chat.resize();chat.construct();chat.init();$(".chat-click").click()}},approve:function(b,c){if($("#noauth").length!=0){return}if(b==("approve")){allow=1}else{allow=0}$("#chat_panel #inbox div[cursor='"+c+"']").remove();var a={instance:chat.instance,room:chat.room,cookie:chat.cookie,mdt:$("#moderator").length,cmo:$("#cmo").html(),cursor:c,allow:allow};$.ajax({url:"/services/chat/approve?i="+chat.destination,type:"GET",cache:false,dataType:"json",data:$.param(a),success:chat.onApproveSuccess,error:chat.onApproveError})},onApproveSuccess:function(a){try{var b=$(a.html);$("#chat_panel #inbox").append(b);chat.sequence=a.sequence;chat.resize()}catch(c){chat.onError();return}},onApproveError:function(a){window.setTimeout(chat.init,5000)},blockInput:function(){if(chat.allow_input==true){chat.allow_input=false;$("#chat-submit").attr("disabled","disabled");$("#message").attr("disabled","disabled");$("#sending").fadeIn(100);window.setTimeout(chat.allowInput,3000)}},allowInput:function(){if(chat.allow_input==false){chat.allow_input=true;$("#chat-submit").removeAttr("disabled");$("#message").removeAttr("disabled");$("#sending").fadeOut(100)}},onVote:function(b){var c=$(b.target);if(!c.hasClass("chat_vote_active")){var a={c:c.parent().attr("cursor"),room:$("#room").html(),instance:$("#instance").html(),mdt:$("#moderator").length,cmo:$("#cmo").html()};c.addClass("chat_vote_active");$.ajax({url:"/services/conversation/promote",type:"GET",cache:false,data:$.param(a)})}},onReply:function(a){var b=$(a.target);var c=b.parent().attr("cursor");$("#chat-reply-id").val(c);$("#message").val("@"+b.parent().find("h5").text()+" ").focus();$("#message").setCursorPosition($("#message").val().length);$("#chat-submit-container").hide();$("#chat-reply-container").show()},onReplyCancel:function(){$("#chat-reply-id").val("");$("#message").val("");$("#chat-submit-container").show();$("#chat-reply-container").hide()}};$(document).ready(function(){if(!window.console){window.console={}}if(!window.console.log){window.console.log=function(){}}chat.construct();chat.init();chat.poll()});var HUD={errorSleepTime:5000,init:function(){$(".show_hud").fadeIn();$(".show_log").fadeIn();$("#hud_save").click(function(a){a.preventDefault();HUD.set()});$(".applyButton").click(function(a){a.preventDefault();HUD.setDynamicValue($(this))});$(".hud-click").click(function(a){$("#hud-popup").fadeIn();$("#video_stream").width("320px");$("#video_stream").height("240px");$(".show_hud").fadeOut()});$(".hud_close").click(function(a){$("#hud-popup").fadeOut();$("#video_stream").width("100%");$("#video_stream").height("100%");$(".show_hud").fadeIn()});$("#hud_reload").click(function(b){b.preventDefault();videoplayer.camViewerReStart();var a={body:"hostset:reload|hostval:null"};$.postJSON("/services/chat/post",a,HUD.finishPost)});$("#qualityLevel_display").html($("#qualityLevel").val());$("#qualityLevel_slider").slider({value:$("#qualityLevel").val(),min:0,max:100,step:1,slide:function(a,b){$("#qualityLevel").val(b.value);$("#qualityLevel_display").html(b.value)}});$("#keyFrameInterval_display").html($("#keyFrameInterval").val());$("#keyFrameInterval_slider").slider({value:$("#keyFrameInterval").val(),min:0,max:48,step:1,slide:function(a,b){$("#keyFrameInterval").val(b.value);$("#keyFrameInterval_display").html(b.value)}});$("#captureFps_display").html($("#captureFps").val());$("#captureFps_slider").slider({value:$("#captureFps").val(),min:0,max:120,step:1,slide:function(a,b){$("#captureFps").val(b.value);$("#captureFps_display").html(b.value)}});$("#bufferMin_display").html($("#bufferMin").val());$("#bufferMin_slider").slider({value:$("#bufferMin").val(),min:0,max:120,step:1,slide:function(a,b){$("#bufferMin").val(b.value);$("#bufferMin_display").html(b.value)}});$("#bufferMax_display").html($("#bufferMax").val());$("#bufferMax_slider").slider({value:$("#bufferMax").val(),min:0,max:240,step:1,slide:function(a,b){$("#bufferMax").val(b.value);$("#bufferMax_display").html(b.value)}});$("#micRate_display").html($("#micRate").val());$("#micRate_slider").slider({value:$("#micRate").val(),min:1,max:5,step:1,slide:function(a,c){switch(c.value){case 1:var b=5;break;case 2:var b=8;break;case 3:var b=11;break;case 4:var b=22;break;case 5:var b=44;break}$("#micRate").val(b);$("#micRate_display").html(b)}});$("#micGain_display").html($("#micGain").val());$("#micGain_slider").slider({value:$("#micGain").val(),min:0,max:100,step:1,slide:function(a,b){$("#micGain").val(b.value);$("#micGain_display").html(b.value)}});$("#motionTimeout_display").html($("#motionTimeout").val());$("#motionTimeout_slider").slider({value:$("#motionTimeout").val(),min:0,max:120000,step:1000,slide:function(a,b){$("#motionTimeout").val(b.value);$("#motionTimeout_display").html(b.value)}});$("#silenceLevel_display").html($("#silenceLevel").val());$("#silenceLevel_slider").slider({value:$("#silenceLevel").val(),min:0,max:100,step:1,slide:function(a,b){$("#silenceLevel").val(b.value);$("#silenceLevel_display").html(b.value)}});$("#micSilenceTimeout_display").html($("#micSilenceTimeout").val());$("#micSilenceTimeout_slider").slider({value:$("#micSilenceTimeout").val(),min:0,max:120000,step:1000,slide:function(a,b){$("#micSilenceTimeout").val(b.value);$("#micSilenceTimeout_display").html(b.value)}})},get:function(){var a={host:$("#hostid").html()};$.ajax({url:"/services/HUD/get",type:"GET",cache:false,dataType:"json",data:$.param(a),timeout:HUD.errorSleepTime,success:HUD.setDefaults,error:HUD.onError})},setDefaults:function(a){for(var b in a.hudSettings){switch(b){case"bandwidthLimit":$("#bandwidthLimit").val(a.hudSettings[b]);break;case"echoSuppression":if(a.hudSettings[b]=="true"){$("#echoSuppression_on").attr("checked","checked")}else{$("#echoSuppression_off").attr("checked","checked")}break;case"enhancedMicrophone":if(a.hudSettings[b]=="true"){$("#enhancedMicrophone_on").attr("checked","checked")}else{$("#enhancedMicrophone_off").attr("checked","checked")}break;case"enableVAD":if(a.hudSettings[b]=="true"){$("#enableVAD_on").attr("checked","checked")}else{$("#enableVAD_off").attr("checked","checked")}break;default:$("#"+b+"_display").html(a.hudSettings[b]);$("#"+b+"_slider").slider({value:a.hudSettings[b]});break}}},set:function(){var b=$("#hud_settings").formToDict();var a={host:$("#hostid").html(),settings:b};$.ajax({url:"/services/HUD/set",type:"GET",cache:false,dataType:"text",data:$.param(a),timeout:HUD.errorSleepTime,success:HUD.onSuccess,error:HUD.onError})},onSuccess:function(a){$("#hud_message").fadeIn();$("#hud_message").html("Success!").delay(3000).fadeOut()},onError:function(a){$("#hud_message").fadeIn();$("#hud_message").html("There was an error.").delay(3000).fadeOut()},setDynamicValue:function(b){var c=$(b).attr("id").replace("Submit","");var a="host_update_"+c;switch(a){case"host_update_bandwidthLimit":value=$("#"+c).val();break;case"host_update_qualityLevel":value=$("#"+c).val();break;case"host_update_keyFrameInterval":value=$("#"+c).val();break;case"host_update_captureFps":value=$("#"+c).val();break;case"host_update_bufferMin":value=$("#"+c).val();break;case"host_update_bufferMax":value=$("#"+c).val();break;case"host_update_micGain":value=$("#"+c).val();break;case"host_update_motionTimeout":value=$("#"+c).val();break;case"host_update_echoSuppression":if($("#echoSuppression_on:checked").val()==1){value="true"}else{value="false"}break;case"host_update_enhancedMicrophone":if($("#echoSuppression_on:checked").val()=="true"){value="true"}else{value="false"}break;case"host_update_silenceLevel":value=$("#"+c).val();break;case"host_update_micSilenceTimeout":value=$("#"+c).val();break;case"host_update_enableVAD":if($("#enableVAD_on:checked").val()=="true"){value="true"}else{value="false"}break}if(document.getElementById("myHost")!=undefined){HUD.pushDynamicValue(a,value)}else{HUD.callDynamicFunction(a,value)}},pushDynamicValue:function(a,b){switch(a){case"host_update_bandwidthLimit":$("#bandwidthLimit").val(b);document.getElementById("myHost").host_update_bandwidthLimit(b);break;case"host_update_qualityLevel":$("#qualityLevel_display").html(b);$("#qualityLevel_slider").slider({value:b});document.getElementById("myHost").host_update_qualityLevel(b);break;case"host_update_keyFrameInterval":$("#keyFrameInterval_display").html(b);$("#keyFrameInterval_slider").slider({value:b});document.getElementById("myHost").host_update_keyFrameInterval(b);break;case"host_update_captureFps":$("#captureFps_display").html(b);$("#captureFps_slider").slider({value:b});document.getElementById("myHost").host_update_captureFPS(b);break;case"host_update_bufferMin":$("#bufferMin_display").html(b);$("#bufferMin_slider").slider({value:b});document.getElementById("myHost").host_update_bufferMin(b);break;case"host_update_bufferMax":$("#bufferMax_display").html(b);$("#bufferMax_slider").slider({value:b});document.getElementById("myHost").host_update_bufferMax(b);break;case"host_update_micGain":$("#micGain_display").html(b);$("#micGain_slider").slider({value:b});document.getElementById("myHost").host_update_micGain(b);break;case"host_update_motionTimeout":$("#motionTimeout_display").html(b);$("#motionTimeout_slider").slider({value:b});document.getElementById("myHost").host_update_motionTimeout(b);break;case"host_update_echoSuppression":if(b=="true"){$("#echoSuppression_on").attr("checked","checked")}else{$("#echoSuppression_off").attr("checked","checked")}document.getElementById("myHost").host_update_echoSuppression(b);break;case"host_update_enhancedMicrophone":if(b=="true"){$("#enhancedMicrophone_on").attr("checked","checked")}else{$("#enhancedMicrophone_off").attr("checked","checked")}document.getElementById("myHost").host_update_enhancedMicrophone(b);break;case"host_update_silenceLevel":$("#silenceLevel_display").html(b);$("#silenceLevel_slider").slider({value:b});document.getElementById("myHost").host_update_silenceLevel(b);break;case"host_update_micSilenceTimeout":$("#micSilenceTimeout_display").html(b);$("#micSilenceTimeout_slider").slider({value:b});document.getElementById("myHost").host_update_micSilenceTimeout(b);break;case"host_update_enableVAD":if(b=="true"){$("#enableVAD_on").attr("checked","checked")}else{$("#enableVAD_off").attr("checked","checked")}document.getElementById("myHost").host_update_enableVAD(b);break}},callDynamicFunction:function(b,c){var a={body:"hostset:"+b+"|hostval:"+c};$.postJSON("/services/chat/post",a,HUD.finishPost)},incomingMessage:function(b){vals=b.html.split("|");var a=vals[0].split(":");var c=vals[1].split(":");console.log(a[1]+" is set to "+c[1]);if(a[1]=="reload"){console.log("restarting");videoplayer.camHostReStart()}else{console.log("setting new value of "+a[1]+" "+c[1]);if(document.getElementById("myHost")!=undefined){HUD.pushDynamicValue(a[1],c[1])}}},finishPost:function(a){}};$(document).ready(function(){if(!window.console){window.console={}}if(!window.console.log){window.console.log=function(){}}if($("#hud-popup").length==1){HUD.init();HUD.get()}});(function(g){function b(){this.regional=[];this.regional[""]={labels:["Years","Months","Weeks","Days","Hours","Minutes","Seconds"],labels1:["Year","Month","Week","Day","Hour","Minute","Second"],compactLabels:["y","m","w","d"],whichLabels:null,timeSeparator:":",isRTL:false};this._defaults={until:null,since:null,timezone:null,serverSync:null,format:"dHMS",layout:"",compact:false,significant:0,description:"",expiryUrl:"",expiryText:"",alwaysExpire:false,onExpiry:null,onTick:null,tickInterval:1};g.extend(this._defaults,this.regional[""]);this._serverSyncs=[]}var l="countdown";var c=0;var h=1;var d=2;var a=3;var m=4;var k=5;var f=6;g.extend(b.prototype,{markerClassName:"hasCountdown",_timer:setInterval(function(){g.countdown._updateTargets()},980),_timerTargets:[],setDefaults:function(n){this._resetExtraLabels(this._defaults,n);e(this._defaults,n||{})},UTCDate:function(p,t,r,u,v,o,q,n){if(typeof t=="object"&&t.constructor==Date){n=t.getMilliseconds();q=t.getSeconds();o=t.getMinutes();v=t.getHours();u=t.getDate();r=t.getMonth();t=t.getFullYear()}var s=new Date();s.setUTCFullYear(t);s.setUTCDate(1);s.setUTCMonth(r||0);s.setUTCDate(u||1);s.setUTCHours(v||0);s.setUTCMinutes((o||0)-(Math.abs(p)<30?p*60:p));s.setUTCSeconds(q||0);s.setUTCMilliseconds(n||0);return s},periodsToSeconds:function(n){return n[0]*31557600+n[1]*2629800+n[2]*604800+n[3]*86400+n[4]*3600+n[5]*60+n[6]},_settingsCountdown:function(p,n){if(!n){return g.countdown._defaults}var o=g.data(p,l);return(n=="all"?o.options:o.options[n])},_attachCountdown:function(q,o){var n=g(q);if(n.hasClass(this.markerClassName)){return}n.addClass(this.markerClassName);var p={options:g.extend({},o),_periods:[0,0,0,0,0,0,0]};g.data(q,l,p);this._changeCountdown(q)},_addTarget:function(n){if(!this._hasTarget(n)){this._timerTargets.push(n)}},_hasTarget:function(n){return(g.inArray(n,this._timerTargets)>-1)},_removeTarget:function(n){this._timerTargets=g.map(this._timerTargets,function(o){return(o==n?null:o)})},_updateTargets:function(){for(var n=this._timerTargets.length-1;n>=0;n--){this._updateCountdown(this._timerTargets[n])}},_updateCountdown:function(t,r){var p=g(t);r=r||g.data(t,l);if(!r){return}p.html(this._generateHTML(r));p[(this._get(r,"isRTL")?"add":"remove")+"Class"]("countdown_rtl");var q=this._get(r,"onTick");if(q){var u=r._hold!="lap"?r._periods:this._calculatePeriods(r,r._show,this._get(r,"significant"),new Date());var n=this._get(r,"tickInterval");if(n==1||this.periodsToSeconds(u)%n==0){q.apply(t,[u])}}var v=r._hold!="pause"&&(r._since?r._now.getTime()<r._since.getTime():r._now.getTime()>=r._until.getTime());if(v&&!r._expiring){r._expiring=true;if(this._hasTarget(t)||this._get(r,"alwaysExpire")){this._removeTarget(t);var o=this._get(r,"onExpiry");if(o){o.apply(t,[])}var y=this._get(r,"expiryText");if(y){var s=this._get(r,"layout");r.options.layout=y;this._updateCountdown(t,r);r.options.layout=s}var w=this._get(r,"expiryUrl");if(w){window.location=w}}r._expiring=false}else{if(r._hold=="pause"){this._removeTarget(t)}}g.data(t,l,r)},_changeCountdown:function(s,p,r){p=p||{};if(typeof p=="string"){var o=p;p={};p[o]=r}var q=g.data(s,l);if(q){this._resetExtraLabels(q.options,p);e(q.options,p);this._adjustSettings(s,q);g.data(s,l,q);var n=new Date();if((q._since&&q._since<n)||(q._until&&q._until>n)){this._addTarget(s)}this._updateCountdown(s,q)}},_resetExtraLabels:function(q,o){var p=false;for(var r in o){if(r!="whichLabels"&&r.match(/[Ll]abels/)){p=true;break}}if(p){for(var r in q){if(r.match(/[Ll]abels[0-9]/)){q[r]=null}}}},_adjustSettings:function(t,r){var o;var u=this._get(r,"serverSync");var q=0;var v=null;for(var p=0;p<this._serverSyncs.length;p++){if(this._serverSyncs[p][0]==u){v=this._serverSyncs[p][1];break}}if(v!=null){q=(u?v:0);o=new Date()}else{var n=(u?u.apply(t,[]):null);o=new Date();q=(n?o.getTime()-n.getTime():0);this._serverSyncs.push([u,q])}var s=this._get(r,"timezone");s=(s==null?-o.getTimezoneOffset():s);r._since=this._get(r,"since");if(r._since!=null){r._since=this.UTCDate(s,this._determineTime(r._since,null));if(r._since&&q){r._since.setMilliseconds(r._since.getMilliseconds()+q)}}r._until=this.UTCDate(s,this._determineTime(this._get(r,"until"),o));if(q){r._until.setMilliseconds(r._until.getMilliseconds()+q)}r._show=this._determineShow(r)},_destroyCountdown:function(o){var n=g(o);if(!n.hasClass(this.markerClassName)){return}this._removeTarget(o);n.removeClass(this.markerClassName).empty();g.removeData(o,l)},_pauseCountdown:function(n){this._hold(n,"pause")},_lapCountdown:function(n){this._hold(n,"lap")},_resumeCountdown:function(n){this._hold(n,null)},_hold:function(q,p){var o=g.data(q,l);if(o){if(o._hold=="pause"&&!p){o._periods=o._savePeriods;var n=(o._since?"-":"+");o[o._since?"_since":"_until"]=this._determineTime(n+o._periods[0]+"y"+n+o._periods[1]+"o"+n+o._periods[2]+"w"+n+o._periods[3]+"d"+n+o._periods[4]+"h"+n+o._periods[5]+"m"+n+o._periods[6]+"s");this._addTarget(q)}o._hold=p;o._savePeriods=(p=="pause"?o._periods:null);g.data(q,l,o);this._updateCountdown(q,o)}},_getTimesCountdown:function(o){var n=g.data(o,l);return(!n?null:(!n._hold?n._periods:this._calculatePeriods(n,n._show,this._get(n,"significant"),new Date())))},_get:function(o,n){return(o.options[n]!=null?o.options[n]:g.countdown._defaults[n])},_determineTime:function(q,n){var p=function(t){var s=new Date();s.setTime(s.getTime()+t*1000);return s};var o=function(w){w=w.toLowerCase();var t=new Date();var B=t.getFullYear();var z=t.getMonth();var C=t.getDate();var v=t.getHours();var u=t.getMinutes();var s=t.getSeconds();var A=/([+-]?[0-9]+)\s*(s|m|h|d|w|o|y)?/g;var y=A.exec(w);while(y){switch(y[2]||"s"){case"s":s+=parseInt(y[1],10);break;case"m":u+=parseInt(y[1],10);break;case"h":v+=parseInt(y[1],10);break;case"d":C+=parseInt(y[1],10);break;case"w":C+=parseInt(y[1],10)*7;break;case"o":z+=parseInt(y[1],10);C=Math.min(C,g.countdown._getDaysInMonth(B,z));break;case"y":B+=parseInt(y[1],10);C=Math.min(C,g.countdown._getDaysInMonth(B,z));break}y=A.exec(w)}return new Date(B,z,C,v,u,s,0)};var r=(q==null?n:(typeof q=="string"?o(q):(typeof q=="number"?p(q):q)));if(r){r.setMilliseconds(0)}return r},_getDaysInMonth:function(n,o){return 32-new Date(n,o,32).getDate()},_normalLabels:function(n){return n},_generateHTML:function(r){var D=this._get(r,"significant");r._periods=(r._hold?r._periods:this._calculatePeriods(r,r._show,D,new Date()));var y=false;var o=0;var q=D;var A=g.extend({},r._show);for(var w=c;w<=f;w++){y|=(r._show[w]=="?"&&r._periods[w]>0);A[w]=(r._show[w]=="?"&&!y?null:r._show[w]);o+=(A[w]?1:0);q-=(r._periods[w]>0?1:0)}var z=[false,false,false,false,false,false,false];for(var w=f;w>=c;w--){if(r._show[w]){if(r._periods[w]){z[w]=true}else{z[w]=q>0;q--}}}var v=this._get(r,"compact");var t=this._get(r,"layout");var s=(v?this._get(r,"compactLabels"):this._get(r,"labels"));var n=this._get(r,"whichLabels")||this._normalLabels;var C=this._get(r,"timeSeparator");var B=this._get(r,"description")||"";var u=function(F){var E=g.countdown._get(r,"compactLabels"+n(r._periods[F]));return(A[F]?r._periods[F]+(E?E[F]:s[F])+" ":"")};var p=function(F){var E=g.countdown._get(r,"labels"+n(r._periods[F]));return((!D&&A[F])||(D&&z[F])?'<span class="countdown_section"><span class="countdown_amount">'+r._periods[F]+"</span><br/>"+(E?E[F]:s[F])+"</span>":"")};return(t?this._buildLayout(r,A,t,v,D,z):((v?'<span class="countdown_row countdown_amount'+(r._hold?" countdown_holding":"")+'">'+u(c)+u(h)+u(d)+u(a)+(A[m]?this._minDigits(r._periods[m],2):"")+(A[k]?(A[m]?C:"")+this._minDigits(r._periods[k],2):"")+(A[f]?(A[m]||A[k]?C:"")+this._minDigits(r._periods[f],2):""):'<span class="countdown_row countdown_show'+(D||o)+(r._hold?" countdown_holding":"")+'">'+p(c)+p(h)+p(d)+p(a)+p(m)+p(k)+p(f))+"</span>"+(B?'<span class="countdown_row countdown_descr">'+B+"</span>":"")))},_buildLayout:function(s,A,u,w,B,z){var t=this._get(s,(w?"compactLabels":"labels"));var o=this._get(s,"whichLabels")||this._normalLabels;var n=function(D){return(g.countdown._get(s,(w?"compactLabels":"labels")+o(s._periods[D]))||t)[D]};var y=function(E,D){return Math.floor(E/D)%10};var p={desc:this._get(s,"description"),sep:this._get(s,"timeSeparator"),yl:n(c),yn:s._periods[c],ynn:this._minDigits(s._periods[c],2),ynnn:this._minDigits(s._periods[c],3),y1:y(s._periods[c],1),y10:y(s._periods[c],10),y100:y(s._periods[c],100),y1000:y(s._periods[c],1000),ol:n(h),on:s._periods[h],onn:this._minDigits(s._periods[h],2),onnn:this._minDigits(s._periods[h],3),o1:y(s._periods[h],1),o10:y(s._periods[h],10),o100:y(s._periods[h],100),o1000:y(s._periods[h],1000),wl:n(d),wn:s._periods[d],wnn:this._minDigits(s._periods[d],2),wnnn:this._minDigits(s._periods[d],3),w1:y(s._periods[d],1),w10:y(s._periods[d],10),w100:y(s._periods[d],100),w1000:y(s._periods[d],1000),dl:n(a),dn:s._periods[a],dnn:this._minDigits(s._periods[a],2),dnnn:this._minDigits(s._periods[a],3),d1:y(s._periods[a],1),d10:y(s._periods[a],10),d100:y(s._periods[a],100),d1000:y(s._periods[a],1000),hl:n(m),hn:s._periods[m],hnn:this._minDigits(s._periods[m],2),hnnn:this._minDigits(s._periods[m],3),h1:y(s._periods[m],1),h10:y(s._periods[m],10),h100:y(s._periods[m],100),h1000:y(s._periods[m],1000),ml:n(k),mn:s._periods[k],mnn:this._minDigits(s._periods[k],2),mnnn:this._minDigits(s._periods[k],3),m1:y(s._periods[k],1),m10:y(s._periods[k],10),m100:y(s._periods[k],100),m1000:y(s._periods[k],1000),sl:n(f),sn:s._periods[f],snn:this._minDigits(s._periods[f],2),snnn:this._minDigits(s._periods[f],3),s1:y(s._periods[f],1),s10:y(s._periods[f],10),s100:y(s._periods[f],100),s1000:y(s._periods[f],1000)};var r=u;for(var q=c;q<=f;q++){var v="yowdhms".charAt(q);var C=new RegExp("\\{"+v+"<\\}(.*)\\{"+v+">\\}","g");r=r.replace(C,((!B&&A[q])||(B&&z[q])?"$1":""))}g.each(p,function(F,D){var E=new RegExp("\\{"+F+"\\}","g");r=r.replace(E,D)});return r},_minDigits:function(o,n){o=""+o;if(o.length>=n){return o}o="0000000000"+o;return o.substr(o.length-n)},_determineShow:function(o){var p=this._get(o,"format");var n=[];n[c]=(p.match("y")?"?":(p.match("Y")?"!":null));n[h]=(p.match("o")?"?":(p.match("O")?"!":null));n[d]=(p.match("w")?"?":(p.match("W")?"!":null));n[a]=(p.match("d")?"?":(p.match("D")?"!":null));n[m]=(p.match("h")?"?":(p.match("H")?"!":null));n[k]=(p.match("m")?"?":(p.match("M")?"!":null));n[f]=(p.match("s")?"?":(p.match("S")?"!":null));return n},_calculatePeriods:function(q,F,u,o){q._now=o;q._now.setMilliseconds(0);var s=new Date(q._now.getTime());if(q._since){if(o.getTime()<q._since.getTime()){q._now=o=s}else{o=q._since}}else{s.setTime(q._until.getTime());if(o.getTime()>q._until.getTime()){q._now=o=s}}var n=[0,0,0,0,0,0,0];if(F[c]||F[h]){var A=g.countdown._getDaysInMonth(o.getFullYear(),o.getMonth());var B=g.countdown._getDaysInMonth(s.getFullYear(),s.getMonth());var t=(s.getDate()==o.getDate()||(s.getDate()>=Math.min(A,B)&&o.getDate()>=Math.min(A,B)));var E=function(H){return(H.getHours()*60+H.getMinutes())*60+H.getSeconds()};var v=Math.max(0,(s.getFullYear()-o.getFullYear())*12+s.getMonth()-o.getMonth()+((s.getDate()<o.getDate()&&!t)||(t&&E(s)<E(o))?-1:0));n[c]=(F[c]?Math.floor(v/12):0);n[h]=(F[h]?v-n[c]*12:0);o=new Date(o.getTime());var G=(o.getDate()==A);var r=g.countdown._getDaysInMonth(o.getFullYear()+n[c],o.getMonth()+n[h]);if(o.getDate()>r){o.setDate(r)}o.setFullYear(o.getFullYear()+n[c]);o.setMonth(o.getMonth()+n[h]);if(G){o.setDate(r)}}var z=Math.floor((s.getTime()-o.getTime())/1000);var p=function(I,H){n[I]=(F[I]?Math.floor(z/H):0);z-=n[I]*H};p(d,604800);p(a,86400);p(m,3600);p(k,60);p(f,1);if(z>0&&!q._since){var w=[1,12,4.3482,7,24,60,60];var y=f;var C=1;for(var D=f;D>=c;D--){if(F[D]){if(n[y]>=C){n[y]=0;z=1}if(z>0){n[D]++;z=0;y=D;C=1}}C*=w[D]}}if(u){for(var D=c;D<=f;D++){if(u&&n[D]){u--}else{if(!u){n[D]=0}}}}return n}});function e(p,o){g.extend(p,o);for(var n in o){if(o[n]==null){p[n]=null}}return p}g.fn.countdown=function(o){var n=Array.prototype.slice.call(arguments,1);if(o=="getTimes"||o=="settings"){return g.countdown["_"+o+"Countdown"].apply(g.countdown,[this[0]].concat(n))}return this.each(function(){if(typeof o=="string"){g.countdown["_"+o+"Countdown"].apply(g.countdown,[this].concat(n))}else{g.countdown._attachCountdown(this,o)}})};g.countdown=new b()})(jQuery);Date.prototype.addHours=function(a){this.setHours(this.getHours()+a);return this};$(document).ready(function(){if(!window.console){window.console={}}if(!window.console.log){window.console.log=function(){}}if($("#counttime").length>0){var b=$("#counttime").html().split("|");var c=new Date(b[0],b[1]-1,b[2],b[3],b[4],b[5]);$("#countdown").countdown({layout:'<span style ="text-transform:lowercase">{dnn}<span class="shorty">DAYS</span>{hnn}<span class="shorty">HRS</span>{mnn}<span class="shorty">MIN</span>{snn}<span class="shorty">s</span></span>',until:c,serverSync:getCurrentTime,format:"DHMS",onExpiry:a})}function a(){if($("#ocb").length>0){try{onExpiry()}catch(d){}}}});var permissionDialogComplete=false;var muteMessageComplete=false;var chatheight_short="240px";var chatheight_tall="350px";var boxheight="450px";function toggleDiv(a){$(".killer").fadeOut(100);if($("#"+a).css("display")=="none"){if(a=="hostchat_panel"){if(typeof chat!=undefined){chat.getRooms()}}if(a=="qanda_panel"){if(chat!=undefined){chat.mode="short";chat.resize}$("#"+a).fadeIn(100);showQaPanel()}else{if(a=="chat_panel"){$("#qanda_panel").css("top","0px");$("#"+a).fadeIn(100);$("#video_stream").css("margin-right","340px");colorme.boxSwitch()}else{$("#"+a).css("top",0);$("#"+a).fadeIn(100)}}if(chat!=undefined){chat.resize()}}else{if(a=="qanda_panel"){$("#"+a).fadeOut(100);if(chat!=undefined){chat.mode="tall";chat.resize}hideQaPanel()}else{if(a=="chat_panel"){$("#qanda_panel").css("bottom","0px");$("#"+a).fadeOut(100).queue(function(){chat.resize();$("#"+a).clearQueue()});$("#video_stream").css("margin-right","0px");colorme.boxSwitch();$(".show_chat").show()}else{$("#"+a).fadeOut(100)}}if(chat!=undefined){chat.resize()}}}function toggleConstellation(){if($(".crash_file").css("display")=="none"){$(".crash_file").css("display","block")}else{$(".crash_file").css("display","none")}}function notifyFlashPermissionDialogComplete(a){permissionDialogComplete=true}function hideQaPanel(){if(qanda!=undefined){qanda.qanda_showing=false}if(typeof videoplayer!=undefined){if($("#has_video").length>0){if($("#is_host").length>0){if(videoplayer){videoplayer.unmute();videoplayer.hideHostCam()}if(qanda!=undefined){qanda.unpublishHost()}}else{if(videoplayer){videoplayer.hideLiveViewer()}}}}}function hideQaWindow(){$("#q_and_a_control").fadeOut(100)}function showQaPanel(){if(qanda!=undefined){qanda.qanda_showing=true}if($("#has_video").length>0){if(typeof videoplayer!=undefined){if($("#is_host").length>0){videoplayer.showHostCam();videoplayer.mute();if(!muteMessageComplete){muteMessageComplete=true}}else{videoplayer.showLiveViewer()}}}if($("#is_host").length>0){}}function showQaWindow(){}function exitSeat(){window.location="/services/Lobby/leave?room="+$("#room").html()+"&seat="+$("#seat").html()+"&film="+$("#film").html()+"&code=exit"}$(document).ready(function(){if(!window.console){window.console={}}if(!window.console.log){window.console.log=function(){}}$(".downarr").click(function(){$("#footer").slideToggle("fast");$("#toolbarbut").fadeIn(100)});$(".showbar").click(function(){$("#footer").slideToggle("fast");$("#toolbarbut").fadeOut()});$(".facebook, .twitter, .delicious, .digg, .rss, .stumble, .menutit, span.downarr a, span.showbar a").click(function(){return false});$(".seat_refresh").click(function(a){location.reload(true)});$(".seat_surrender").click(function(a){exitSeat()});$(".constellation-click").click(function(a){toggleConstellation()});$(".chat-click").click(function(a){toggleDiv("chat_panel")});$(".info-click").click(function(a){toggleDiv("info_panel")});$(".qanda-click").click(function(a){toggleDiv("qanda_panel")});$(".help-click").click(function(a){toggleDiv("help_panel")});$(".hostchat-click").click(function(a){toggleDiv("hostchat_panel")});$(".admin-click").click(function(a){toggleDiv("adminmessage_panel")});$(".test-click").click(function(a){videoplayer.camViewerReStart()});$("#qanda_panel h4").click(function(a){toggleDiv("qanda_panel")});$("#qa_pop_top a").click(function(a){hideQaWindow()});$("#chat_panel h4").click(function(a){toggleDiv("chat_panel")});$("#info_panel h4").click(function(a){$("#info_panel").fadeOut(100)});$("#help_panel h4").click(function(a){$("#help_panel").fadeOut(100)});$("#hostchat_panel h4").click(function(a){$("#hostchat_panel").fadeOut(100)});$("#adminmessage_panel h4").click(function(a){$("#adminmessage_panel").fadeOut(100)});if($("#has_video").html()=="true"){toggleDiv("qanda_panel")}});var fb_invite={itRetrievedContacts:0,collectedEmails:new Array(),purchaseSubmitted:false,currentPrice:0,priceDiscount:0.25,gbip:false,fb_token:null,screening:null,user_type:null,user_id:null,user_name:null,init:function(){$(".fb_dialog_close_icon").click(function(){$("#invite_facebook_lb").fadeOut(100);modal.modalOut(login.hidepopup)});$("#ok_clicked").click(function(b){b.preventDefault();fb_invite.sendInvites()});$("#cancel_clicked").click(function(b){b.preventDefault();$("#invite_facebook_lb").fadeOut(100);modal.modalDestroy()});$(".all_friends").click(function(b){fb_invite.selectAllFriends()});if(window.location.href.match(/fb_invite/)){var a=window.location.href.split("fb_invite=");fb_invite.invite("screening",a[1])}},goModal:function(){modal.modalIn(login.hidepopup)},invite:function(b,a){if(a===undefined){a=$("#screening").html()}fb_invite.user_type=b;fb_invite.screening=a;if($("#fb_user_list .selectItem").length==0){error.showError("alert",'<p align="center">Loading Your Friends</p>','<img src="/images/ajax-loader.gif" alt="loading" />',0);if($("#fb_user_list").length>0){$.ajax({url:"/services/Facebook/token",type:"GET",cache:false,dataType:"json",timeout:10000,success:function(c){fb_invite.getLoginStatus(c)},error:function(c){console.log("ERROR:",c);error.showError("error","communication error","Please try again")}})}}else{fb_invite.showDialog()}},getLoginStatus:function(b){if(b.status!="undefined"){fb_invite.fb_token=b.authResponse.accessToken;fb_invite.user_id=b.authResponse.userId;fb_invite.user_name=b.authResponse.userName;fb_invite.getInvites()}else{var a="/services/Facebook/auth?dest="+document.location.pathname+"^fb_invite="+fb_invite.screening;window.location=a}},getInvites:function(){$.ajax({url:"/services/Facebook/friends",type:"GET",cache:false,dataType:"json",timeout:4000,success:function(a){fb_invite.showInvites(a)},error:function(a){error.showError("error","communication error","Please try again")}})},showInvites:function(a){for(x=0;x<a.data.length;x++){if($(".fb_invites[value="+a.data[x].id+"]").length==0){$("#fb_user_list").append('<span class="selectItem"><table cellspacing="4"><tr><td><input class="fb_invites" type="checkbox" value="'+a.data[x].id+'" /></td><td><img src="https://graph.facebook.com/'+a.data[x].id+'/picture" title="'+a.data[x].name+'" /></td><td>'+a.data[x].name+"</td></tr></table></span>")}}$("#fb_share_user_image").attr("src","https://graph.facebook.com/"+fb_invite.user_id+"/picture");fb_invite.showDialog()},showDialog:function(){setTop("#invite_facebook_lb");$("#fb_in").show();error.unblock();$("#invite_facebook_lb").fadeIn();fb_invite.goModal();surl=fb_invite.screening.replace(/(#.+)/,"");var a={screening:surl};$.ajax({url:"/services/Invite/info",type:"GET",cache:true,dataType:"json",data:$.param(a),timeout:4000,success:function(b){if(b.screening_image!=""){$("#fb_share_preview_image").attr("src",b.screening_image)}else{$("#fb_share_preview_image").attr("src","/uploads/screeningResources/"+b.screening_film_id+"/logo/film_logo"+b.screening_film_logo)}var c="{Your Message} - "+fb_invite.user_name+" has invited you to a showing of "+b.screening_film_name+" on Constellation, at "+b.time_tz+" on "+b.time_dayofweek+", "+b.time_date+". - '"+b.screening_film_synopsis+"'";$("#fb_share_preview_text").html(c)},error:function(b){console.log("ERROR:",b);error.showError("error","communication error","Please try again")}})},selectAllFriends:function(){if($(".all_friends").html()=="All Friends"){$(".all_friends").html("No Friends");$(".fb_invites").attr("checked","checked")}else{$(".all_friends").html("All Friends");$(".fb_invites").removeAttr("checked")}},sendInvites:function(){if($("#fb_invite_message").val()==""){error.showError("error","Please enter a message prior to sending your invitations.",null,2000);return}error.showError("alert",'<p align="center">Sending Invitations...</p>','<img src="/images/ajax-loader.gif" alt="loading" />',2000);fbs=[];j=0;var a=$(":checkbox:checked","#invite_facebook");$.each(a,function(c,d){fbs.push($(this).val())});var b={facebooks:fbs,user_type:fb_invite.user_type,fb_session:fb_invite.fb_token,screening:fb_invite.screening,name:fb_invite.user_name,subject:$("#form_invite_email_subject").val().replace(/\n/g,"<br/>"),message:$("#fb_invite_message").val().replace(/\n/g,"<br/>")};$.ajax({url:"/services/Invite/send",data:$.param(b),type:"POST",cache:false,dataType:"json",timeout:4000,success:function(c){fb_invite.finishInvites(c)},error:function(c){console.log("ERROR:",c);error.showError("error","communication error","Please try again")}})},finishInvites:function(a){if(a.result=="success"){try{if(typeof screening_room!="undefined"){screening_room.sentInvites(a.count)}}catch(b){}try{if(typeof host_screening!="undefined"){host_screening.sentInvites(a.count)}}catch(b){}error.showError("alert",a.message,null,2000);$("#invite_facebook_lb").delay(4000).fadeOut(100);modal.modalDestroy()}else{error.showError("error",a.message,null,2000)}}};function toggleChecked(a){$(".fb_invites").each(function(){$(this).attr("checked",a)})}$(document).ready(function(){if(!window.console){window.console={}}if(!window.console.log){window.console.log=function(){}}fb_invite.init()});var invite={itRetrievedContacts:0,collectedEmails:new Array(),purchaseSubmitted:false,currentPrice:0,priceDiscount:0.25,gbip:false,user_type:"screening",screening:null,init:function(){if($("#gbip").html()==1){invite.geoblock()}$(".lb_close").click(function(f){$("#invite_email_lb").fadeOut(100);modal.modalOut(invite.hidepopup)});$("#form_invite_email_body").inputlimiter({limit:150,limitTextShow:false,boxId:"invite-textbox-limit",remTextHideOnBlur:"false"});$("#btn-invite").click(function(f){f.preventDefault();invite.sendInvites()});var d=window.location.search;if(/invite=true/.test(d)){d=d.replace("?","");d=d.split("&");for(var b=0;b<d.length;b++){if(/type=/.test(d[b])){var c=d[b].replace("type=","")}else{if(/screening=/.test(d[b])){var a=d[b].replace("screening=","")}}}if(!!a&&!!c){invite.invite(c,a)}}},hidepopup:function(){$("#invite_email_lb").fadeOut()},goModal:function(){modal.modalIn(invite.hidepopup)},invite:function(c,b){if($(".main-login").length==0||/boxoffice/.test(window.location)){if(b===undefined){b=$("#screening").html()}invite.user_type=c;invite.screening=b;setTop("#invite_email_lb");$("#invite_email_lb").fadeIn();invite.goModal()}else{var a=window.location.protocol+"//"+window.location.hostname+window.location.pathname;a=a+(!!window.location.search?window.location.search+"&":"?")+"invite=true&invite-type="+c+"&screening="+b;console.log(a);$("#login_destination").val(a);$("#signup_destination").val(a);login.showpopup()}},showErrors:function(a){if(!$("#"+a+" .error-panel").is(":visible")){$("#"+a+" .error-panel").animate({width:"toggle"},500)}},sendInvites:function(){console.log("Sending Invites");if($("#form_invite_email_to").val()==""){error.showError("error","There are no people to invite,<br /> please add some email addresses and try again.");return}if($("#form_invite_email_subject").val()==""){error.showError("error","Please enter a subject.");return}if($("#form_invite_email_body").val()==""){error.showError("error","Please enter a message.");return}error.showError("alert",'<p align="center">Sending Invitations...</p>','<img src="/images/ajax-loader.gif" alt="loading" />',2000);emails=[];console.log("There are "+emails.length+" emails.");j=0;var a=$("#form_invite_email_to").val().split(",");$.each(a,function(d,e){var c=e.replace(/^\s+|\s+$/g,"");console.log(c);if(invite.isValidEmailAddress(c)){emails.push(c)}});var b={emails:emails,user_type:invite.user_type,screening:invite.screening,subject:$("#form_invite_email_subject").val().replace(/\n/g,"<br/>"),message:$("#form_invite_email_body").val().replace(/\n/g,"<br/>")};$.ajax({url:"/services/Invite/send",data:$.param(b),type:"POST",cache:false,dataType:"json",timeout:4000,success:function(c){invite.finishInvites(c)},error:function(c){console.log("ERROR:",c);error.showError("error","communication error","Please try again")}})},finishInvites:function(a){if(a.result=="success"){try{if(typeof screening_room!="undefined"){screening_room.sentInvites(a.count)}}catch(b){}try{if(typeof host_screening!="undefined"){host_screening.sentInvites(a.count)}}catch(b){}error.showError("alert",a.message,null,2000);$("#invite_email_lb").delay(4000).fadeOut(100);modal.modalDestroy()}else{error.showError("error",a.message,null,2000)}},isValidEmailAddress:function(b){var a=new RegExp(/^(("[\w-\s]+")|([\w-]+(?:\.[\w-]+)*)|("[\w-\s]+")([\w-]+(?:\.[\w-]+)*))(@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][0-9]\.|1[0-9]{2}\.|[0-9]{1,2}\.))((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\]?$)/i);return a.test(b)},updatePrice:function(b){if(b>0){screening_room.currentPrice=b;var a=new Number(screening_room.currentPrice);$(".ticket_price").html(a.toFixed(2));$("#ticket_price").val(a.toFixed(2))}},updateCount:function(){$("#number_invites").html($("#accepted-invites-container li").length)},geoblock:function(){$(".gbip-close").click(function(){$("#geoblock").fadeOut(400).queue(function(){screening_room.invite();$("#geoblock").clearQueue()})});screening_room.gbip=false;$("#geoblock").fadeIn()}};$(document).ready(function(){if(!window.console){window.console={}}if(!window.console.log){window.console.log=function(){}}invite.init()});