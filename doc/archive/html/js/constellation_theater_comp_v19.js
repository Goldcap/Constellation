/*
 * jQuery Cycle Lite Plugin
 * http://malsup.com/jquery/cycle/lite/
 * Copyright (c) 2008 M. Alsup
 * Version: 1.0 (06/08/2008)
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 * Requires: jQuery v1.2.3 or later
 */
(function(b){var a="Lite-1.0";b.fn.cycle=function(e){return this.each(function(){e=e||{};if(this.cycleTimeout){clearTimeout(this.cycleTimeout)}this.cycleTimeout=0;this.cyclePause=0;var j=b(this);var h=e.slideExpr?b(e.slideExpr,this):j.children();var l=h.get();if(l.length<2){if(window.console&&window.console.log){window.console.log("terminating; too few slides: "+l.length)}return}var k=b.extend({},b.fn.cycle.defaults,e||{},b.metadata?j.metadata():b.meta?j.data():{});k.before=k.before?[k.before]:[];k.after=k.after?[k.after]:[];k.after.unshift(function(){k.busy=0});var m=this.className;k.width=parseInt((m.match(/w:(\d+)/)||[])[1])||k.width;k.height=parseInt((m.match(/h:(\d+)/)||[])[1])||k.height;k.timeout=parseInt((m.match(/t:(\d+)/)||[])[1])||k.timeout;if(j.css("position")=="static"){j.css("position","relative")}if(k.width){j.width(k.width)}if(k.height&&k.height!="auto"){j.height(k.height)}var g=0;h.css({position:"absolute",top:0,left:0}).hide().each(function(n){b(this).css("z-index",l.length-n)});b(l[g]).css("opacity",1).show();if(b.browser.msie){l[g].style.removeAttribute("filter")}if(k.fit&&k.width){h.width(k.width)}if(k.fit&&k.height&&k.height!="auto"){h.height(k.height)}if(k.pause){j.hover(function(){this.cyclePause=1},function(){this.cyclePause=0})}b.fn.cycle.transitions.fade(j,h,k);h.each(function(){var n=b(this);this.cycleH=(k.fit&&k.height)?k.height:n.height();this.cycleW=(k.fit&&k.width)?k.width:n.width()});h.not(":eq("+g+")").css({opacity:0});if(k.cssFirst){b(h[g]).css(k.cssFirst)}if(k.timeout){if(k.speed.constructor==String){k.speed={slow:600,fast:200}[k.speed]||400}if(!k.sync){k.speed=k.speed/2}while((k.timeout-k.speed)<250){k.timeout+=k.speed}}k.speedIn=k.speed;k.speedOut=k.speed;k.slideCount=l.length;k.currSlide=g;k.nextSlide=1;var f=h[g];if(k.before.length){k.before[0].apply(f,[f,f,k,true])}if(k.after.length>1){k.after[1].apply(f,[f,f,k,true])}if(k.click&&!k.next){k.next=k.click}if(k.next){b(k.next).bind("click",function(){return c(l,k,k.rev?-1:1)})}if(k.prev){b(k.prev).bind("click",function(){return c(l,k,k.rev?1:-1)})}if(k.timeout){this.cycleTimeout=setTimeout(function(){d(l,k,0,!k.rev)},k.timeout+(k.delay||0))}})};function d(h,n,j,g){if(n.busy){return}var k=h[0].parentNode,e=h[n.currSlide],f=h[n.nextSlide];if(k.cycleTimeout===0&&!j){return}if(j||!k.cyclePause){if(n.before.length){b.each(n.before,function(p,o){o.apply(f,[e,f,n,g])})}var m=function(){if(b.browser.msie){this.style.removeAttribute("filter")}b.each(n.after,function(p,o){o.apply(f,[e,f,n,g])})};if(n.nextSlide!=n.currSlide){n.busy=1;b.fn.cycle.custom(e,f,n,m)}var l=(n.nextSlide+1)==h.length;n.nextSlide=l?0:n.nextSlide+1;n.currSlide=l?h.length-1:n.nextSlide-1}if(n.timeout){k.cycleTimeout=setTimeout(function(){d(h,n,0,!n.rev)},n.timeout)}}function c(j,h,e){var f=j[0].parentNode,g=f.cycleTimeout;if(g){clearTimeout(g);f.cycleTimeout=0}h.nextSlide=h.currSlide+e;if(h.nextSlide<0){h.nextSlide=j.length-1}else{if(h.nextSlide>=j.length){h.nextSlide=0}}d(j,h,1,e>=0);return false}b.fn.cycle.custom=function(e,h,g,l){var f=b(e),j=b(h);j.css({opacity:0});var k=function(){j.animate({opacity:1},g.speedIn,g.easeIn,l)};f.animate({opacity:0},g.speedOut,g.easeOut,function(){f.css({display:"none"});if(!g.sync){k()}});if(g.sync){k()}};b.fn.cycle.transitions={fade:function(f,e,g){e.not(":eq(0)").css("opacity",0);g.before.push(function(){b(this).show()})}};b.fn.cycle.ver=function(){return a};b.fn.cycle.defaults={timeout:4000,speed:1000,next:null,prev:null,before:null,after:null,height:"auto",sync:1,fit:0,pause:0,delay:0,slideExpr:null}})(jQuery);(function(a){a.extend({head:function(b,d,e,c){if(a.isFunction(d)){e=d;d={}}if(c==undefined){c=2000}return a.ajax({type:"HEAD",url:b,data:d,timeout:c,complete:function(j,m){var k=j.getAllResponseHeaders().split("\n");var f={};var g=k.length;for(var h=0;h<g;h++){if(k[h].length!=0){header=k[h].split(": ");f[header[0]]=header[1]}}if(a.isFunction(e)){e(f)}}})}})})(jQuery);(function($){$.fn.editable=function(target,options){if("disable"==target){$(this).data("disabled.editable",true);return}if("enable"==target){$(this).data("disabled.editable",false);return}if("destroy"==target){$(this).unbind($(this).data("event.editable")).removeData("disabled.editable").removeData("event.editable");return}var settings=$.extend({},$.fn.editable.defaults,{target:target},options);var plugin=$.editable.types[settings.type].plugin||function(){};var submit=$.editable.types[settings.type].submit||function(){};var buttons=$.editable.types[settings.type].buttons||$.editable.types.defaults.buttons;var content=$.editable.types[settings.type].content||$.editable.types.defaults.content;var element=$.editable.types[settings.type].element||$.editable.types.defaults.element;var reset=$.editable.types[settings.type].reset||$.editable.types.defaults.reset;var callback=settings.callback||function(){};var onedit=settings.onedit||function(){};var onsubmit=settings.onsubmit||function(){};var onreset=settings.onreset||function(){};var onerror=settings.onerror||reset;if(settings.tooltip){$(this).attr("title",settings.tooltip)}settings.autowidth="auto"==settings.width;settings.autoheight="auto"==settings.height;return this.each(function(){var self=this;var savedwidth=$(self).width();var savedheight=$(self).height();$(this).data("event.editable",settings.event);if(!$.trim($(this).html())){$(this).html(settings.placeholder)}$(this).bind(settings.event,function(e){if(true===$(this).data("disabled.editable")){return}if(self.editing){return}if(false===onedit.apply(this,[settings,self])){return}e.preventDefault();e.stopPropagation();if(settings.tooltip){$(self).removeAttr("title")}if(0==$(self).width()){settings.width=savedwidth;settings.height=savedheight}else{if(settings.width!="none"){settings.width=settings.autowidth?$(self).width():settings.width}if(settings.height!="none"){settings.height=settings.autoheight?$(self).height():settings.height}}if($(this).html().toLowerCase().replace(/(;|")/g,"")==settings.placeholder.toLowerCase().replace(/(;|")/g,"")){$(this).html("")}self.editing=true;self.revert=$(self).html();$(self).html("");var form=$("<form />");if(settings.cssclass){if("inherit"==settings.cssclass){form.attr("class",$(self).attr("class"))}else{form.attr("class",settings.cssclass)}}if(settings.style){if("inherit"==settings.style){form.attr("style",$(self).attr("style"));form.css("display",$(self).css("display"))}else{form.attr("style",settings.style)}}var input=element.apply(form,[settings,self]);var input_content;if(settings.loadurl){var t=setTimeout(function(){input.disabled=true;content.apply(form,[settings.loadtext,settings,self])},100);var loaddata={};loaddata[settings.id]=self.id;if($.isFunction(settings.loaddata)){$.extend(loaddata,settings.loaddata.apply(self,[self.revert,settings]))}else{$.extend(loaddata,settings.loaddata)}$.ajax({type:settings.loadtype,url:settings.loadurl,data:loaddata,async:false,success:function(result){window.clearTimeout(t);input_content=result;input.disabled=false}})}else{if(settings.data){input_content=settings.data;if($.isFunction(settings.data)){input_content=settings.data.apply(self,[self.revert,settings])}}else{input_content=self.revert}}content.apply(form,[input_content,settings,self]);input.attr("name",settings.name);buttons.apply(form,[settings,self]);$(self).append(form);plugin.apply(form,[settings,self]);$(":input:visible:enabled:first",form).focus();if(settings.select){input.select()}input.keydown(function(e){if(e.keyCode==27){e.preventDefault();reset.apply(form,[settings,self])}});var t;if("cancel"==settings.onblur){input.blur(function(e){t=setTimeout(function(){reset.apply(form,[settings,self])},500)})}else{if("submit"==settings.onblur){input.blur(function(e){t=setTimeout(function(){form.submit()},200)})}else{if($.isFunction(settings.onblur)){input.blur(function(e){settings.onblur.apply(self,[input.val(),settings])})}else{input.blur(function(e){})}}}form.submit(function(e){if(t){clearTimeout(t)}e.preventDefault();if(false!==onsubmit.apply(form,[settings,self])){if(false!==submit.apply(form,[settings,self])){if($.isFunction(settings.target)){var str=settings.target.apply(self,[input.val(),settings]);$(self).html(str);self.editing=false;callback.apply(self,[self.innerHTML,settings]);if(!$.trim($(self).html())){$(self).html(settings.placeholder)}}else{var submitdata={};submitdata[settings.name]=input.val();submitdata[settings.id]=self.id;if($.isFunction(settings.submitdata)){$.extend(submitdata,settings.submitdata.apply(self,[self.revert,settings]))}else{$.extend(submitdata,settings.submitdata)}if("PUT"==settings.method){submitdata._method="put"}$(self).html(settings.indicator);var ajaxoptions={type:"POST",data:submitdata,dataType:"html",url:settings.target,success:function(result,status){if(ajaxoptions.dataType=="html"){$(self).html(result)}self.editing=false;callback.apply(self,[result,settings]);if(!$.trim($(self).html())){$(self).html(settings.placeholder)}},error:function(xhr,status,error){onerror.apply(form,[settings,self,xhr])}};$.extend(ajaxoptions,settings.ajaxoptions);$.ajax(ajaxoptions)}}}$(self).attr("title",settings.tooltip);return false})});this.reset=function(form){if(this.editing){if(false!==onreset.apply(form,[settings,self])){$(self).html(self.revert);self.editing=false;if(!$.trim($(self).html())){$(self).html(settings.placeholder)}if(settings.tooltip){$(self).attr("title",settings.tooltip)}}}}})};$.editable={types:{defaults:{element:function(settings,original){var input=$('<input type="hidden" id="'+settings.name+'_editable"></input>');$(this).append(input);return(input)},content:function(string,settings,original){$(":input:first",this).val("")},reset:function(settings,original){original.reset(this)},buttons:function(settings,original){var form=this;if(settings.submit){if(settings.submit.match(/>$/)){var submit=$(settings.submit).click(function(){if(submit.attr("type")!="submit"){form.submit()}})}else{var submit=$('<button type="submit" />');submit.html(settings.submit)}$(this).append(submit)}if(settings.cancel){if(settings.cancel.match(/>$/)){var cancel=$(settings.cancel)}else{var cancel=$('<button type="cancel" />');cancel.html(settings.cancel)}$(this).append(cancel);$(cancel).click(function(event){if($.isFunction($.editable.types[settings.type].reset)){var reset=$.editable.types[settings.type].reset}else{var reset=$.editable.types.defaults.reset}reset.apply(form,[settings,original]);return false})}}},text:{element:function(settings,original){var input=$("<input />");if(settings.width!="none"){input.width(settings.width)}if(settings.height!="none"){input.height(settings.height)}input.attr("autocomplete","off");$(this).append(input);return(input)}},textarea:{element:function(settings,original){var textarea=$('<textarea id="'+settings.name+'_editable" />');if(settings.rows){textarea.attr("rows",settings.rows)}else{if(settings.height!="none"){textarea.height(settings.height)}}if(settings.cols){textarea.attr("cols",settings.cols)}else{if(settings.width!="none"){textarea.width(settings.width)}}$(this).append(textarea);return(textarea)}},select:{element:function(settings,original){var select=$("<select />");$(this).append(select);return(select)},content:function(data,settings,original){if(String==data.constructor){eval("var json = "+data)}else{var json=data}for(var key in json){if(!json.hasOwnProperty(key)){continue}if("selected"==key){continue}var option=$("<option />").val(key).append(json[key]);$("select",this).append(option)}$("select",this).children().each(function(){if($(this).val()==json.selected||$(this).text()==$.trim(original.revert)){$(this).attr("selected","selected")}})}}},addInputType:function(name,input){$.editable.types[name]=input}};$.fn.editable.defaults={name:"value",id:"id",type:"text",width:"auto",height:"auto",event:"click.editable",onblur:"cancel",loadtype:"GET",loadtext:"Loading...",placeholder:"Click to edit",loaddata:{},submitdata:{},ajaxoptions:{}}})(jQuery);(function(a){a.fn.inputlimiter=function(b){var c=a.extend({},a.fn.inputlimiter.defaults,b);if(c.boxAttach&&!a("#"+c.boxId).length){a("<div/>").appendTo("body").attr({id:c.boxId,"class":c.boxClass}).css({position:"absolute"}).hide();if(a.fn.bgiframe){a("#"+c.boxId).bgiframe()}}a(this).each(function(d){a(this).unbind();a(this).keyup(function(j){if(a(this).val().length>c.limit){a(this).val(a(this).val().substring(0,c.limit))}if(c.boxAttach){a("#"+c.boxId).css({width:a(this).outerWidth()-(a("#"+c.boxId).outerWidth()-a("#"+c.boxId).width())+"px",left:a(this).offset().left+"px",top:(a(this).offset().top+a(this).outerHeight())-1+"px","z-index":2000})}var g=c.limit-a(this).val().length;var h=c.remTextFilter(c,g);var f=c.limitTextFilter(c);if(c.limitTextShow){a("#"+c.boxId).html(h+" "+f);var k=a("<span/>").appendTo("body").attr({id:"19cc9195583bfae1fad88e19d443be7a","class":c.boxClass}).html(h+" "+f).innerWidth();a("#19cc9195583bfae1fad88e19d443be7a").remove();if(k>a("#"+c.boxId).innerWidth()){a("#"+c.boxId).html(h+"<br />"+f)}a("#"+c.boxId).show()}else{a("#"+c.boxId).html(h).show()}});a(this).keypress(function(f){if((!f.keyCode||(f.keyCode>46&&f.keyCode<90))&&a(this).val().length>=c.limit){return false}});a(this).blur(function(){if(c.boxAttach){a("#"+c.boxId).fadeOut("fast")}else{if(c.remTextHideOnBlur){var e=c.limitText;e=e.replace(/\%n/g,c.limit);e=e.replace(/\%s/g,(c.limit==1?"":"s"));a("#"+c.boxId).html(e)}}})})};a.fn.inputlimiter.remtextfilter=function(d,b){var c=d.remText;if(b==0&&d.remFullText!=null){c=d.remFullText}c=c.replace(/\%n/g,b);c=c.replace(/\%s/g,(d.zeroPlural?(b==1?"":"s"):(b<=1?"":"s")));return c};a.fn.inputlimiter.limittextfilter=function(c){var b=c.limitText;b=b.replace(/\%n/g,c.limit);b=b.replace(/\%s/g,(c.limit<=1?"":"s"));return b};a.fn.inputlimiter.defaults={limit:255,boxAttach:true,boxId:"limiterBox",boxClass:"limiterBox",remText:"%n character%s remaining.",remTextFilter:a.fn.inputlimiter.remtextfilter,remTextHideOnBlur:true,remFullText:null,limitTextShow:false,limitText:"Field limited to %n character%s.",limitTextFilter:a.fn.inputlimiter.limittextfilter,zeroPlural:true}})(jQuery);var timekeeper={currentTime:null,movieStartTime:null,reviewStartTime:null,promoStartTime:null,qaStartTime:null,viewBlockTime:null,viewEndTime:null,currentPanel:"prescreening-panel",init:function(){timekeeper.currentTime=new Date().getTime()/1000;timekeeper.movieStartTime=$("#starttime").html();timekeeper.reviewStartTime=$("#reviewtime").html();timekeeper.promoStartTime=$("#promotime").html();timekeeper.qaStartTime=$("#qatime").html();timekeeper.viewBlockTime=$("#blockentrytime").html();timekeeper.viewEndTime=$("#endtime").html();if($("#noauth").length==0){error.showError("error","Please Note: If you leave the theater and plan to come back from another location...","be sure to use the 'exit theater' button in the toolbar! Otherwise, you may not be permitted to return to the theater.",4000)}toggleDiv("chat_panel")},poll:function(a){timekeeper.currentTime=a;switch(true){case (timekeeper.currentTime>timekeeper.viewEndTime):window.location.href="/lobby/"+$("#room").html()+"/"+$("#seat").html()+"?code=exp";break;case ((timekeeper.currentTime>timekeeper.movieStartTime)&&(timekeeper.currentTime<timekeeper.viewEndTime)):if((timekeeper.currentTime>timekeeper.movieStartTime+5)&&($(".screening_still").css("display")=="none")){$(".screening_still").fadeIn()}timekeeper.startMovie();break;default:console.log("No time detected!");break}},checkMovieTime:function(){console.log("CurrentTime:"+timekeeper.currentTime);console.log("StartTime:"+timekeeper.movieStartTime);console.log("EndTime:"+timekeeper.viewEndTime);if((timekeeper.currentTime>timekeeper.movieStartTime)&&(timekeeper.currentTime<timekeeper.viewEndTime)){return true}return false},startMovie:function(){if((timekeeper.currentPanel=="video_panel")&&(document.getElementById(videoplayer.div)!=undefined)){return}$("#status_panel").html("Status: Screening");timekeeper.currentPanel="video_panel";$("#timer_panel").fadeOut("slow");$("#prescreening_panel").fadeOut("slow");$("#video_panel").fadeIn("slow");if(videoplayer.state=="pre"){if($("#noauth").length==0){error.showError("error","Please Note: If you encounter any problems with streaming quality,","please first try to refresh your browser. If the problem persists, please 'Exit' the theater, and then re-enter from the lobby. Thank you.",6000);videoplayer.initPlayer()}}},startReview:function(){if(timekeeper.currentPanel=="review_panel"){return}$("#status_panel").html("Status: Reviews");timekeeper.currentPanel="review_panel";$("#review_panel").fadeIn("slow")},startPromo:function(){if(timekeeper.currentPanel=="promo_panel"){return}$("#status_panel").html("Status: Promos");timekeeper.currentPanel="promo_panel";$("#review_panel").fadeOut("slow");$("#promo_panel").fadeIn("slow");promotions.init()},startQA:function(){if(timekeeper.currentPanel=="qa_panel"){return}$("#status_panel").html("Status: Q And A");timekeeper.currentPanel="qa_panel";qanda.allowScreeningClose();$("#promo_panel").fadeOut("slow")}};$(document).ready(function(){if(!window.console){window.console={}}if(!window.console.log){window.console.log=function(){}}timekeeper.init()});function getCookie(a){var b=document.cookie.match("\\b"+a+"=([^;]*)\\b");return b?b[1]:undefined}jQuery.fn.formToDict=function(){var a=this.serializeArray();var c={};for(var b=0;b<a.length;b++){c[a[b].name]=a[b].value}if(c.next){delete c.next}return c};jQuery.fn.disable=function(){this.enable(false);return this};jQuery.fn.enable=function(a){if(arguments.length&&!a){this.attr("disabled","disabled")}else{this.removeAttr("disabled")}return this};var activity={errorSleepTime:5000,cursor:null,host:null,port:null,instance:null,room:null,destination:null,user:null,users:null,registry:null,construct:function(){activity.host=$("#host").html();activity.port=parseInt($("#port").html())+13090;activity.instance=$("#instance").html();activity.room=$("#room").html();activity.film=$("#film").html();activity.destination=activity.host+":"+activity.port;activity.user=$("#userid").html();activity.users=new Array();activity.registry=new Array()},init:function(){if($("#noauth").length!=0){return}if(activity.room==""){return}var a={room:activity.room,instance:activity.instance,userid:activity.user,location:activity.location,cookie:$.cookie("constellation_frontend")};$.ajax({url:"/services/activity/init?i="+activity.destination,type:"GET",cache:false,dataType:"text",data:$.param(a),success:activity.onInitSuccess,error:activity.onInitError})},onInitSuccess:function(response){try{if(!response){return}var response=eval("("+response+")");activity.tempusers=new Array();for(var i=0;i<response.users.length;i++){if(response.users[i].userid!=undefined){activity.pushUser(response.users[i]);activity.showUser(response.users[i])}}if(activity.users.length>activity.tempusers.length){for(var i=0;i<activity.users.length;i++){activity.dropUser(activity.users[i])}}activity.showUserCount()}catch(e){console.log("Activity Error");activity.onInitError();return}},onInitError:function(a){console.log("Activity Init Error");window.setTimeout(activity.init,5000)},pushUser:function(a){if(a.userid==undefined){return}activity.tempusers.push(a.userid);if($.inArray(a.userid,activity.users)==-1){activity.users.push(a.userid);activity.registry[a.userid]=a.username}},dropUser:function(a,b){if($.inArray(a,activity.tempusers)==-1){activity.removeUser(a);delete activity.registry[a];activity.users=jQuery.grep(activity.users,function(c){return c!=a})}},announce:function(){if($("#noauth").length!=0){return}if(activity.room==""){return}var a={film:activity.film,room:activity.room,instance:activity.instance,userid:activity.user,location:activity.location,cookie:$.cookie("constellation_frontend")};$.ajax({url:"/services/activity/announce?i="+activity.destination,type:"POST",cache:false,dataType:"text",data:$.param(a),success:activity.onAnnounceSuccess,error:activity.onAnnounceError})},onAnnounceSuccess:function(response){try{var response=eval("("+response+")");activity.showUser(response.users[0]);activity.tempusers=new Array();activity.pushUser(response.users[0]);activity.showUserCount()}catch(e){activity.onError();return}},onAnnounceError:function(a){console.log("Activity Announce Error");window.setTimeout(activity.announce,5000)},status:function(){if($("#noauth").length!=0){return}if(activity.room==""){return}try{var a="/services/activity/status?i="+activity.destination+"&room="+activity.room+"&userid="+activity.user+"&instance="+activity.instance+"&location="+activity.location+"&film="+activity.film+"&cookie="+$.cookie("constellation_frontend");$.head(a,{},function(c){$.each(c,function(d,g){if(d=="X-User-Get"){try{if(g!=activity.users.length){activity.init()}}catch(f){}}if(d=="X-Server-Time"){try{timekeeper.poll(g)}catch(f){}}});window.setTimeout(activity.status,5000)},activity.errorSleepTime-2000)}catch(b){window.setTimeout(activity.status,5000)}},poll:function(){if($("#noauth").length!=0){return}if(activity.room==""){return}var a={room:$("#room").html(),userid:$("#userid").html(),location:activity.location,cookie:$.cookie("constellation_frontend")};$.ajax({url:"/services/activity/update?i="+activity.destination,type:"POST",cache:false,dataType:"text",data:$.param(a),timeout:activity.errorSleepTime,success:activity.onPollSuccess,error:activity.onPollError})},onPollSuccess:function(response){try{if(!response){return}var response=eval("("+response+")");for(var i=0;i<response.users.length;i++){activity.showUser(response.users[i],true)}}catch(e){activity.onError();return}activity.errorSleepTime=100;window.setTimeout(activity.poll,0)},onPollError:function(a){console.log("Activity Poll error; sleeping for",activity.errorSleepTime,"ms");window.setTimeout(activity.poll,activity.errorSleepTime)},showUserCount:function(){if($("#userCount").length>0){$("#userCount").html(activity.users.length)}},showUser:function(b){if($("#adminmessage-users").length>0){var a="green";if(b.location=="lobby"){a="orange"}if($("#adminuser-"+b.userid).length>0){userdata='<a name="adminmessageuser-'+b.userid+'" id="adminmessageuser-'+b.userid+'" title="'+b.username+'" onClick="adminmessage.startAdminChat(this)"><img src="/images/Neu/8x8/status/online-'+a+'.png" /></a>';$("#adminuser-"+b.userid+"-status").html(userdata)}else{html='<div class="message" id="adminuser-'+b.userid+'"><span id="adminuser-'+b.userid+'-block"><a name="adminmessageuser-'+b.userid+'" id="blockmessageuser-'+b.userid+'" title="'+b.username+'" onClick="adminmessage.blockSeat(this)"><img src="/images/Neu/8x8/status/important.png" /></a></span><span id="adminuser-'+b.userid+'-status"><a name="adminmessageuser-'+b.userid+'" id="adminmessageuser-'+b.userid+'" title="'+b.username+'" onClick="adminmessage.electAdminChat(this)"><img src="/images/Neu/8x8/status/online-'+a+'.png" /></a></span><strong>'+b.username+"</strong></div>";$("#adminmessage-users").append(html)}}if($("#user-"+b.userid).length==0){var d=Math.floor(Math.random()*98);var c=Math.floor(Math.random()*121);html='<a style="position: relative; top: '+c+"px; left: "+d+'%;" name="constellation-'+b.userid+'" class="host-star" id="user-'+b.userid+'" title="'+b.username+'" onClick="privatechat.startPrivateChat(this)"><img src="/images/host-star.png" /></a>';$("#constellation_map").append(html)}},setUserLocation:function(c,d,a){var b="green";if(a=="lobby"){b="orange"}if($("#adminuser-"+userid).length>0){userdata='<a name="adminmessageuser-'+userid+'" id="adminmessageuser-'+userid+'" title="'+username+'" onClick="adminmessage.startAdminChat(this)"><img src="/images/Neu/8x8/status/online-'+b+'.png" /></a>';$("#adminuser-"+userid+"-status").html(userdata)}},removeUser:function(a){if($("#adminmessage-users").length==0){if($("#adminuser-"+a+"-status").length==0){$("#adminuser-"+a+"-status").html("Offline").attr("style","color:red")}}if(($("#user-"+a).length>0)&&(a!=$("#userid").html())){$("#user-"+a).remove()}}};$(document).ready(function(){if(!window.console){window.console={}}if(!window.console.log){window.console.log=function(){}}if(window.location.pathname.match(/theater/)){activity.location="theater"}if(window.location.pathname.match(/lobby/)){activity.location="lobby"}activity.construct();activity.init();activity.announce();activity.status()});function newMessage(b){var a=b.formToDict();if((/Enter Your Message Here/.test($("#messageform [name=body]").val()))||($("#messageform [name=body]").val()=="")){return false}$.postJSON("/services/chat/post",a,function(c){chat.init();if(a.id){b.parent().remove()}else{$("#messageform [name=body]").val("")}})}function getCookie(a){var b=document.cookie.match("\\b"+a+"=([^;]*)\\b");return b?b[1]:undefined}jQuery.postJSON=function(url,args,callback){args.room=$("#room").html();args.instance=$("#instance").html();args.author=$("#userid").html();args.cookie=$.cookie("constellation_frontend");args.film=$("#film").html();$.ajax({url:url+"?i="+$("#host").html()+":"+(parseInt($("#port").html())+9090),data:$.param(args),type:"POST",cache:false,dataType:"text",success:function(response){if(callback){callback(eval("("+response+")"))}},error:function(response){console.log("ERROR:",response)}})};jQuery.fn.formToDict=function(){var a=this.serializeArray();var c={};for(var b=0;b<a.length;b++){c[a[b].name]=a[b].value}if(c.next){delete c.next}return c};jQuery.fn.disable=function(){this.enable(false);return this};jQuery.fn.enable=function(a){if(arguments.length&&!a){this.attr("disabled","disabled")}else{this.removeAttr("disabled")}return this};var chat={location:null,errorSleepTime:900000,cursor:null,host:null,port:null,instance:null,room:null,destination:null,inbox:null,scroller:null,watermark:"Enter Your Message Here:",construct:function(){chat.proxy="http://"+$("#proxy").html();chat.cookie=$.cookie("constellation_frontend");chat.host=$("#host").html();chat.port=parseInt($("#port").html())+9090;chat.instance=$("#instance").html();chat.room=$("#room").html();chat.destination=chat.host+":"+chat.port;if(window.location.pathname.match(/theater/)){chat.location="theater"}if(window.location.pathname.match(/screening/)){chat.location="screening"}if(window.location.pathname.match(/lobby/)){chat.location="lobby"}if($("#messageform").length>0){$("#messageform").submit(function(){if(($("#message").val()==chat.watermark)||($("#message").val()=="")){return false}newMessage($("#messageform"));$("#message").val("");return false});$("#chat-submit").click(function(b){if(($("#message").val()==chat.watermark)||($("#message").val()=="")){return false}b.stopPropagation();newMessage($("#messageform"));$("#message").val("");return false});$("#chat_panel").click(function(b){$("#message").select()});$("#message").select();$("#message").watermark(chat.watermark)}var a=$("#chat_panel #inbox").jScrollPane({verticalDragMinHeight:10,verticalDragMaxHeight:10,verticalGutter:0});chat.inbox=$("#chat_panel #inbox .jspPane");chat.scroller=a.data("jsp");if($("#chat_refresh").length>0){$("#chat_refresh").click(function(b){chat.inbox.html("");chat.init();return false})}},init:function(){if($("#noauth").length!=0){return}var a={instance:chat.instance,room:chat.room,cookie:chat.cookie};if(chat.cursor){a.cursor=chat.cursor}$.ajax({url:"/services/chat/init?i="+chat.destination,type:"GET",cache:false,dataType:"text",data:$.param(a),success:chat.onInitSuccess,error:chat.onInitError})},onInitSuccess:function(a){try{chat.inbox.html(a);chat.resize()}catch(b){chat.onError();return}},onInitError:function(a){window.setTimeout(chat.init,5000)},poll:function(){if($("#noauth").length!=0){return}var a={instance:chat.instance,room:chat.room,cookie:chat.cookie};if(chat.cursor){a.cursor=chat.cursor}$.ajax({url:"/services/chat/update?i="+chat.destination,type:"POST",cache:false,dataType:"text",data:$.param(a),timeout:chat.errorSleepTime,success:chat.onSuccess,error:chat.onError})},onSuccess:function(response){try{chat.newMessages(eval("("+response+")"))}catch(e){chat.onError();return}window.setTimeout(chat.poll,0)},onError:function(a){console.log("Error");window.setTimeout(chat.poll,0)},newMessages:function(a){if(!a.messages){return}chat.cursor=a.cursor;var c=a.messages;chat.cursor=c[c.length-1].id;for(var b=0;b<c.length;b++){if(c[b].room==chat.room){chat.showMessage(c[b])}}},showMessage:function(c){var b=$("#m"+c.id);if(b.length>0){return}var a=$(c.html);if((chat.location=="screening")||(chat.location=="theater")){chat.inbox.append(a);chat.resize()}else{$("#constellation_map").append(html);chat.remove()}},remove:function(){var a=19;if($("#constellation_map div").length>a){for(i=a;i<=$("#constellation_map div").length;i++){$("#constellation_map div:nth-child("+i+")").remove()}}},resize:function(){if((chat.scroller!=null)&&(chat.scroller!=undefined)){chat.scroller.reinitialise();chat.scroller.scrollToBottom()}},getRooms:function(){var a={room:chat.room,instance:chat.instance};$.ajax({url:"/services/chat/rooms?i="+chat.destination,type:"GET",cache:false,dataType:"json",data:$.param(a),success:function(b){var c="";for(i=0;i<b.rooms.length;i++){if(b.rooms[i].key!=undefined){if((b.rooms[i].name==undefined)||(b.rooms[i].name=="")){b.rooms[i].name=b.rooms[i].key}c+='<li><a href="javascript:void(0);" onclick="chat.switchRoom(this)" title="'+b.rooms[i].key+'">Chat Room '+b.rooms[i].name+"</a></li>"}}if(c!=""){$("#chatroom-instances").html(c)}}})},switchRoom:function(a){if($("#instance").html()!=a.getAttribute("title")){$("#instance").html(a.getAttribute("title"));chat.inbox.html("");chat.resize();chat.construct();chat.init();$(".chat-click").click()}}};$(document).ready(function(){if(!window.console){window.console={}}if(!window.console.log){window.console.log=function(){}}chat.construct();chat.init();chat.poll()});function newQAMessage(b){console.log("newQAMessage");if(qanda.showCount()){if((/Enter Your Message Here/.test($("#qandaform [name=body]").val()))||($("#qandaform [name=body]").val()=="")){$("#qa-message").html("Please enter a question. You have "+(qanda.totalquestions-$(".question").length)+" more questions.").css("color","red");return false}var a=b.formToDict();console.log("Postin!");$.postQandAJSON("/services/qanda/post",a,function(c){qanda.showMessage(c);if(a.id){b.parent().remove()}else{$("#qandaform [name=body]").val("")}})}}jQuery.postQandAJSON=function(url,args,callback){args.room=$("#room").html();args.author=$("#userid").html();$.ajax({url:url+"?i="+$("#host").html()+":"+(parseInt($("#port").html())+15090),data:$.param(args),type:"POST",cache:false,dataType:"text",success:function(response){if(callback){callback(eval("("+response+")"))}},error:function(response){}})};var qanda={totalquestions:4,errorSleepTime:900000,watermark:"Enter Your Message Here",currentquestions:0,pollRunning:true,slideRunning:true,host:null,port:null,instance:null,room:null,destination:null,user:null,inbox:null,listbox:null,selected_inbox:null,scroller:null,inbox:null,qanda_showing:false,construct:function(){qanda.host=$("#host").html();qanda.port=parseInt($("#port").html())+15090;qanda.instance=$("#instance").html();qanda.room=$("#room").html();qanda.screening=$("#qscreening_id").html();qanda.destination=qanda.host+":"+qanda.port;qanda.user=$("#userid").html();qanda.inbox=$("#qanda-inbox");qanda.listbox=$("#qa_list");qanda.selected_inbox=$("#qanda-inbox").html()},init:function(){$(".qa_pop_up .popup-close").click(function(b){toggleDiv("qanda_panel")});$("#qanda_switch").click(function(b){toggleDiv("qanda_panel")});$("#host_screening_webcam").click(function(b){if($("#host_screening_webcam").val()=="disable webcam"){if(typeof videoplayer!=undefined){if($("#is_host").length>0){videoplayer.hideHostCam()}}$("#host_screening_webcam").val("enable webcam")}else{if(typeof videoplayer!=undefined){if($("#is_host").length>0){videoplayer.showHostCam()}}$("#host_screening_webcam").val("disable webcam")}});$("#host_screening_refresh").click(function(b){qanda.getCurrent()});$("#host_screening_qanda").click(function(b){toggleDiv("qanda_panel")});$("#qa_panel h4").click(function(b){toggleDiv("qanda_panel")});if($("#qandaform").length>0){console.log("#qandaform submit");$("#qandaform").submit(function(){if(($("#qanda_message").val()==qanda.watermark)||($("#qanda_message").val()=="")){return false}newQAMessage($("#qandaform"));$("#qanda_message").val("");return false});$("#qanda-submit").click(function(b){if(($("#qanda_message").val()==qanda.watermark)||($("#qanda_message").val()=="")){return false}b.stopPropagation();newQAMessage($("#qandaform"));$("#qanda_message").val("");return false});$("#qanda_message").select();$("#qanda_message").watermark(qanda.watermark);qanda.showCount();qanda.slidePoll();qanda.setQuestionCount()}if($("#qanda-host-inbox").length>0){console.log("Setting Up JScroller for QandA");var a=$("#qanda-host-inbox").jScrollPane({verticalDragMinHeight:10,verticalDragMaxHeight:10,verticalGutter:0});qanda.inbox=$("#qanda-host-inbox .jspPane");qanda.scroller=a.data("jsp")}if($("#answerform").length>0){$("#answerform").live("submit",function(){qanda.postSlide();return false});$("#answer-submit").click(function(b){qanda.postSlide();return false})}},setQuestionCount:function(){qanda.currentquestions=$("#qanda-host-selected-inbox li").length+$("#qanda-host-inbox li").length},showMessage:function(c){console.log("Showing Message");var b=$("#q"+c.id);if(b.length>0){return}for(amess in c.questions){console.log(unescape(c.questions[amess].html));var a=$(unescape(c.questions[amess].html));qanda.inbox.append(a);var d='<li id="qe-'+c.questions[amess].id+'">'+unescape(c.questions[amess].body)+"</li>";qanda.listbox.append(d);qanda.showCount()}},showCount:function(){if($("#qanda-inbox .question").length>qanda.totalquestions){$("#qa-message").html("You have asked all of your "+qanda.totalquestions+" questions.").css("color","red");return false}else{$("#qa-message").html("You have "+(qanda.totalquestions-$("#qanda-inbox .question").length)+" more questions.");return true}},status:function(){if(qanda.destination==undefined){return}$.head("/services/qanda/status?i="+qanda.destination+"&screening="+qanda.screening+"&userid="+qanda.user,{},function(a){$.each(a,function(b,d){if(b=="X-Question-Get"){try{if(d!=qanda.currentquestions){qanda.poll()}}catch(c){}}if(b=="X-Server-Time"){try{timekeeper.poll(d)}catch(c){console.log("No Timer Available")}}});window.setTimeout(qanda.status,5000)})},poll:function(){var a={screening:qanda.screening,room:qanda.room,instance:qanda.instance,userid:qanda.user};$.ajax({url:"/services/qanda/history?i="+qanda.destination,type:"GET",cache:false,dataType:"text",data:$.param(a),success:qanda.onSuccess,error:qanda.onError})},onSuccess:function(response){response=eval("("+response+")");if(!response.questions){return}var questions=response.questions;console.log(questions.length,"new qanda messages");for(var i=0;i<questions.length;i++){if(questions[i].room==qanda.room){var existing=$("#q"+questions[i].id);if(existing.length>0){continue}var node=$(questions[i].html);qanda.inbox.prepend(node);qanda.scroller.reinitialise()}}qanda.setQuestionCount();if(qanda.pollRunning){}},slidePoll:function(){var a={room:qanda.room};$.ajax({url:"/services/qanda/update?i="+qanda.destination,type:"POST",cache:false,dataType:"text",data:$.param(a),timeout:qanda.errorSleepTime,success:qanda.onSlideSuccess,error:qanda.onError})},onSlideSuccess:function(response){try{response=eval("("+response+")");if(!response.questions){return}var questions=response.questions;for(var i=0;i<questions.length;i++){console.log("Question ID: "+questions[i].id);if((questions[i].id==0)&&($("#qa_showing_list li").length>0)){qanda.onSuccess(quesions[i])}else{if(questions[i].id==-1){console.log("Clearing Questions");$("#qa_showing_list li").remove()}else{if(questions[i].id==-2){if(($("#is_host").length==0)&&(!qanda.qanda_showing)){console.log("Restarting Host Stream");if(videoplayer!=undefined){videoplayer.camViewerReStart()}}}else{if(questions[i].id==-3){console.log("qanda_showing is "+qanda.qanda_showing);console.log("IS HOST is "+$("#is_host").length);if(($("#is_host").length==0)&&(qanda.qanda_showing)){console.log("Stopping Host Stream");if(videoplayer!=undefined){videoplayer.hideLiveViewer()}}}else{if((questions[i].room==qanda.room)&&(questions[i].id!=0)&&($("#qs-"+questions[i].id).length==0)){html='<li id="qs-'+questions[i].id+'">'+questions[i].html+"</li>";$("#qa_showing_list li").remove();$("#qa_showing_list").append(html)}}}}}}}catch(e){qanda.onError();return}window.setTimeout(qanda.slidePoll,0)},onError:function(){window.setTimeout(qanda.slidePoll,qanda.errorSleepTime)},closeInput:function(){qanda.pollRunning=false;qanda.closeQandA();$("#qanda-host-inbox, #qanda-host-selected-inbox").sortable("destroy");$("#qanda-host-selected-inbox .handle img").attr("src","/images/dnd-go.png");$("#qanda-host-inbox .handle img").attr("src","/images/dnd-stop.png");$("#qanda-host-selected-inbox .handle img").click(function(a){a.stopPropagation();qanda.showSlide($(this).closest("li").attr("id"))})},killQandA:function(){var a={room:qanda.room,instance:qanda.instance};$.ajax({url:"/services/qanda/close?i="+qanda.destination,type:"GET",cache:false,dataType:"text",data:$.param(a)})},showSlide:function(b){var a={room:qanda.room,instance:qanda.instance,screening:qanda.screening,question:b};$("#q"+b+" table tr > td:nth-child(1) img").attr("src","/images/dnd-stop.png");$.ajax({url:"/services/qanda/slide?i="+qanda.destination,type:"GET",cache:false,dataType:"json",data:$.param(a),success:function(c){if($("#qe-"+c.id).length==0){html='<li id="qe-'+c.id+'">'+c.html+"</li>";$("#qa_showing_list li").remove();$("#qa_showing_list").append(html)}}})},clearSlides:function(){$("#qa_showing_list li").remove();var a={room:qanda.room,instance:qanda.instance,screening:qanda.screening,message:-1};$.ajax({url:"/services/qanda/message?i="+qanda.destination,type:"GET",cache:false,dataType:"json",data:$.param(a),success:function(b){}})},publishHost:function(){console.log("Republishing Host Stream");var a={room:qanda.room,instance:qanda.instance,screening:qanda.screening,message:-2};$.ajax({url:"/services/qanda/message?i="+qanda.destination,type:"GET",cache:false,dataType:"json",data:$.param(a),success:function(b){}})},unpublishHost:function(){console.log("Unpublishing Host Stream");var a={room:qanda.room,instance:qanda.instance,screening:qanda.screening,message:-3};$.ajax({url:"/services/qanda/message?i="+qanda.destination,type:"GET",cache:false,dataType:"json",data:$.param(a),success:function(b){}})},allowScreeningClose:function(){$("#host_screening_end").fadeIn("slow");$("#host_screening_end_also").fadeIn("slow")},getCurrent:function(){var a={room:qanda.room,screening:qanda.screening};$.ajax({url:"/services/qanda/current?i="+qanda.destination,type:"POST",cache:false,dataType:"text",data:$.param(a),timeout:qanda.errorSleepTime,success:qanda.onCurrentSuccess,error:qanda.onCurrentError})},onCurrentSuccess:function(response){console.log("Current Success");response=eval("("+response+")");if($("#qe-"+response.id).length==0){html='<li id="qe-'+response.id+'">'+response.html+"</li>";$("#qa_showing_list li").remove();$("#qa_showing_list").append(html)}},onCurrentError:function(){console.log("Current Error");window.setTimeout(qanda.getCurrent,5000)}};$(document).ready(function(){if(!window.console){window.console={}}if(!window.console.log){window.console.log=function(){}}});var permissionDialogComplete=false;var muteMessageComplete=false;var chatheight_short="240px";var chatheight_tall="350px";var boxheight="450px";function toggleDiv(a){$(".killer").fadeOut(100);if(a=="qanda_panel"){if(!qanda.qanda_showing){showQaPanel();return}else{hideQaPanel();return}}if($("#"+a).css("display")=="none"){console.log("#"+a+" is hidden");if(a=="hostchat_panel"){if(typeof chat!=undefined){chat.getRooms()}}if(a=="qanda_panel"){showQaPanel()}else{if((a=="chat_panel")&&($("#qanda_panel").css("display")=="block")){$("#"+a).fadeIn(100)}else{if((a=="chat_panel")&&($("#qanda_panel").css("display")=="none")){$("#"+a).fadeIn(100)}else{$("#"+a).css("top",0);$("#"+a).fadeIn(100)}}}if(chat!=undefined){chat.resize()}}else{console.log("#"+a+" is showing");if(a=="qanda_panel"){hideQaPanel()}else{if(a=="chat_panel"){}else{$("#"+a).fadeOut(100)}}if(chat!=undefined){chat.resize()}}}function toggleConstellation(){if($(".crash_file").css("display")=="none"){$(".crash_file").css("display","block")}else{$(".crash_file").css("display","none")}}function notifyFlashPermissionDialogComplete(a){permissionDialogComplete=true;toshowQaWindow()}function hideQaPanel(){if(qanda!=undefined){qanda.qanda_showing=false}if(typeof videoplayer!=undefined){if($("#has_video").length>0){if($("#is_host").length>0){if(videoplayer){videoplayer.unmute();videoplayer.hideHostCam()}if(qanda!=undefined){qanda.unpublishHost()}}else{if(videoplayer){videoplayer.hideLiveViewer()}}}}}function hideQaWindow(){$("#q_and_a_control").fadeOut(100)}function showQaPanel(){if(!timekeeper.checkMovieTime()){error.showError("error","","Q+A is unavailable until the movie starts.",7000);return}if(qanda!=undefined){qanda.qanda_showing=true}if($("#has_video").length>0){if(typeof videoplayer!=undefined){if($("#is_host").length>0){videoplayer.showHostCam();videoplayer.mute();if(!muteMessageComplete){error.showError("error","","While you are in Q+A mode, your movie volume has been muted to prevent those attending the Q+A from hearing a distorting echo. Don't worry - everyone else can still hear you and the movie.",7000);muteMessageComplete=true}}else{videoplayer.showLiveViewer()}}}$("#chat_panel").fadeIn(100);if($("#is_host").length>0){}}function showQaWindow(){if(!timekeeper.checkMovieTime()){error.showError("error","","Q+A is unavailable until the movie starts.",7000);return}}function exitSeat(){window.location="/services/Lobby/leave?room="+$("#room").html()+"&seat="+$("#seat").html()+"&film="+$("#film").html()+"&code=exit"}$(document).ready(function(){if(!window.console){window.console={}}if(!window.console.log){window.console.log=function(){}}$(".downarr").click(function(){$("#footer").slideToggle("fast");$("#toolbarbut").fadeIn(100)});$(".showbar").click(function(){$("#footer").slideToggle("fast");$("#toolbarbut").fadeOut()});$(".facebook, .twitter, .delicious, .digg, .rss, .stumble, .menutit, span.downarr a, span.showbar a").click(function(){return false});$(".seat_refresh").click(function(a){location.reload(true)});$(".seat_surrender").click(function(a){exitSeat()});$(".constellation-click").click(function(a){toggleConstellation()});$(".chat-click").click(function(a){toggleDiv("chat_panel")});$(".info-click").click(function(a){toggleDiv("info_panel")});$(".qanda-click").click(function(a){toggleDiv("qanda_panel")});$(".help-click").click(function(a){toggleDiv("help_panel")});$(".hostchat-click").click(function(a){toggleDiv("hostchat_panel")});$(".admin-click").click(function(a){toggleDiv("adminmessage_panel")});$(".test-click").click(function(a){videoplayer.camViewerReStart()});$("#qanda_panel h4").click(function(a){toggleDiv("qanda_panel")});$("#qa_pop_top a").click(function(a){hideQaWindow()});$("#chat_panel h4").click(function(a){toggleDiv("chat_panel")});$("#info_panel h4").click(function(a){$("#info_panel").fadeOut(100)});$("#help_panel h4").click(function(a){$("#help_panel").fadeOut(100)});$("#hostchat_panel h4").click(function(a){$("#hostchat_panel").fadeOut(100)});$("#adminmessage_panel h4").click(function(a){$("#adminmessage_panel").fadeOut(100)})});